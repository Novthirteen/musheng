AjaxControlToolkit.HTMLEditor.MSIE_list=function(r){var f="LI",h=false,a=null,m=this,k=m.get_paragraphs(),j=m.getSelectionAfterOperation(k),e=a,c=[],g=m,b=a,d=[],n=r.toUpperCase(),q=h;function i(){if(b!=a){var e;e=b.cloneNode(h);b.parentNode.insertBefore(e,b);while(b.firstChild!=d[0])e.appendChild(b.firstChild);e.firstChild==a&&e.parentNode.removeChild(e);if(b.tagName.toUpperCase()==n)for(var k=0;k<d.length;k++){var c=d[k];if(c.nodeType==1&&c.tagName&&c.tagName.toUpperCase()==f){var p=h;b.parentNode.insertBefore(c,b);if(c.style.textAlign=="")c.style.textAlign=b.style.textAlign;if(b.childNodes.length==0&&k==d.length-1){b.parentNode.removeChild(b);b=a}if(c.style.textAlign==""||c.style.textAlign.toLowerCase()=="left"&&!g.rtlState()||c.style.textAlign.toLowerCase()=="right"&&g.rtlState()){p=g.tryUnWrap(c,j);if(p)q=true}if(!p){for(var l=g._doc.createElement(g.dfltBlockElement),o=c.attributes,m=0;m<o.length;++m){var i=o.item(m);if(!i.specified)continue;if(i.name.toLowerCase()=="style")continue;l.setAttribute(i.name,i.value)}l.style.cssText=c.style.cssText;if(l.tagName.toUpperCase()=="P")l.style.margin="0px";while(c.firstChild)l.appendChild(c.firstChild);c.parentNode.insertBefore(l,c);c.parentNode.removeChild(c)}}else b.parentNode.insertBefore(c,b)}else{for(var e=g._doc.createElement(n),o=b.attributes,m=0;m<o.length;++m){var i=o.item(m);if(!i.specified)continue;if(i.name.toLowerCase()=="style")continue;e.setAttribute(i.name,i.value)}e.style.cssText=b.style.cssText;b.parentNode.insertBefore(e,b);for(var k=0;k<d.length;k++){var c=d[k];e.appendChild(c)}}if(b!=a){e=b.cloneNode(h);b.parentNode.insertBefore(e,b);while(b.firstChild)e.appendChild(b.firstChild);e.firstChild==a&&e.parentNode.removeChild(e);b.parentNode.removeChild(b)}}b=a;d=[]}function p(){var t="BR",E=e.firstChild,F=e.lastChild,q=e.tagName.toUpperCase();if(!AjaxControlToolkit.HTMLEditor.isInlineElement(e)&&c[0][0]==E&&c[c.length-1][c[c.length-1].length-1]==F&&(q=="OL"||q=="UL"||q=="DL"||q==f||(q=="P"||q=="DIV"||AjaxControlToolkit.HTMLEditor.isHeader(e))&&q==f)){i();d=[];if(q==f){b=e.parentNode;d.push(e)}else if(q=="P"||q=="DIV"||AjaxControlToolkit.HTMLEditor.isHeader(e)){b=e.parentNode.parentNode;d.push(e.parentNode)}else{b=e;for(var s=0;s<c.length;s++)for(var r=c[s],m=0;m<r.length;m++)d.push(r[m])}i()}else if(q==f&&c.length<k.length){if(b!=e.parentNode){i();b=e.parentNode;d=[]}d.push(e)}else if(q=="OL"||q=="UL"||q=="DL"){i();b=e;d=[];for(var s=0;s<c.length;s++)for(var r=c[s],m=0;m<r.length;m++)d.push(r[m]);i()}else{var l=a,o=a;function v(){if(l!=a)if(l.childNodes==1&&(l.firstChild==j[0]||l.firstChild==j[1])){l.parentNode.insertBefore(l.firstChild,l);l.parentNode.removeChild(l)}l=a}b!=a&&i();var y="";if(c.length==1&&c[0].length==1&&c[0][0].nodeType==1&&c[0][0].tagName)y=c[0][0].tagName.toUpperCase();if(y=="OL"||y=="UL"||y=="DL"){var p=c[0][0];b=p;d=[];for(var s=0;s<p.childNodes.length;s++){var H=p.childNodes.item(s);d.push(H)}i()}else for(var s=0;s<c.length;s++){for(var r=c[s],m=0;m<r.length;m++){var p=r[m],z=p.tagName?p.tagName.toUpperCase():"";if(o==a){o=g._doc.createElement(n);p.parentNode.insertBefore(o,p)}if(!AjaxControlToolkit.HTMLEditor.isInlineElement(p)&&z!=t){l&&l.firstChild&&v();if(l==a){l=g._doc.createElement(f);o.appendChild(l)}l.appendChild(p);v()}else{if(l==a){l=g._doc.createElement(f);o.appendChild(l)}var C=r[r.length-1]==j[1]?r.length-1:r.length,D=r[0]==j[0]?1:0;if(z==t&&m==C-1&&m==D)if(AjaxControlToolkit.HTMLEditor.isIE){l.appendChild(g._doc.createTextNode(String.fromCharCode(160)));p.parentNode.removeChild(p)}else l.appendChild(p);else if(z==t&&m==C-1&&m>D)p.parentNode.removeChild(p);else l.appendChild(p);if(z==t&&m==r.length-1){v();l=a}if(p==j[1]&&m==r.length-1){v();l=a}}}l&&l.firstChild&&v()}if(o!=a){for(var u=[],m=0;m<o.childNodes.length;m++)u.push(o.childNodes.item(m).style.textAlign);for(var w=1;w<u.length;w++)if(u[w-1]!=u[w])break;if(w==u.length){for(var G=u[0]=="left"&&!g.rtlState()||u[0]=="right"&&g.rtlState()?"":u[0],m=0;m<o.childNodes.length;m++)o.childNodes.item(m).style.textAlign="";o.style.textAlign=G}}if(o!=a)if(o.parentNode.tagName.toUpperCase()=="P"&&o.parentNode.childNodes.length==1){var x=o.parentNode,A=x.cloneNode(h);x.parentNode.insertBefore(o,x);x.parentNode.removeChild(x);if(o.childNodes.length==1){var B=o.firstChild;while(B.firstChild)A.appendChild(B.firstChild);B.appendChild(A)}else delete A}}}for(var o=0;o<k.length;o++){var l=k[o];if(l.length>0){if(l[0].parentNode!=e){c.length>0&&p();c=[];e=l[0].parentNode}c.push(l)}}c.length>0&&p();b!=a&&i();m.setSelectionAfterOperation(j,q)};AjaxControlToolkit.HTMLEditor.MSIE_justify=function(e,u,p){var a="",k=false,g=true,c=null,o=this,r=o.get_paragraphs(),h=o.getSelectionAfterOperation(r),b=c,f=[],j=o,d=typeof u!="undefined"&&u?g:k,i=typeof p=="string"?g:k,l=typeof p=="string"?p:a,m=k;function q(a){if(a!=c)if(a.childNodes==1&&(a.firstChild==h[0]||a.firstChild==h[1])){a.parentNode.insertBefore(a.firstChild,a);a.parentNode.removeChild(a)}}function t(){var H="TABLE",u="0px",D="LI",C="remain",s="left",o="P",z="DIV",y="align",U=b.firstChild,V=b.lastChild,T=k,x;if(b.tagName&&!AjaxControlToolkit.HTMLEditor.isInlineElement(b)&&f[0][0]==U&&f[f.length-1][f[f.length-1].length-1]==V){x=b.tagName.toUpperCase();if(x!="TD"&&x!="TH"&&x!="FIELDSET"&&x!="LEGEND")T=g}if(T){var L=a;if(b.getAttribute(y)&&b.getAttribute(y).length>0)L=b.getAttribute(y);if(b.align&&b.align.length>0)L=b.align;if(b.style.textAlign&&b.style.textAlign.length>0)L=b.style.textAlign;b.align=a;b.setAttribute(y,a);b.removeAttribute(y);if((x==z||x==o||AjaxControlToolkit.HTMLEditor.isHeader(b))&&e==s&&d){if(j.tryUnWrap(b,h,d))m=g}else{if(e!=C)if(!(e==s&&d)||x==D&&b.parentNode.style.textAlign.length>0)b.style.textAlign=e;else b.style.textAlign=a;if(d)b.style.margin=x==o?u:a;if(x==D){for(var t=b.parentNode,w=[],F=0;F<t.childNodes.length;F++)t.childNodes.item(F).nodeType==1&&w.push(t.childNodes.item(F).style.textAlign);for(var A=1;A<w.length;A++)if(w[A-1]!=w[A])break;if(A==w.length){for(var L=w[0]==s&&d?a:w[0],r=0;r<t.childNodes.length;r++)if(t.childNodes.item(r).nodeType==1){t.childNodes.item(r).style.textAlign=a;if(d)t.childNodes.item(r).style.margin=t.childNodes.item(r).tagName.toUpperCase()==o?u:a}t.style.textAlign=L}}if((x==z||x==o||AjaxControlToolkit.HTMLEditor.isHeader(b))&&i&&l.toUpperCase()!=x){for(var E=j._doc.createElement(l),M=b.attributes,K=0;K<M.length;++K){var G=M.item(K);if(!G.specified)continue;if(G.name.toLowerCase()=="style")continue;E.setAttribute(G.name,G.value)}E.style.cssText=b.style.cssText;while(b.firstChild)E.appendChild(b.firstChild);b.parentNode.insertBefore(E,b);b.parentNode.removeChild(b)}}}else for(var v=c,Q=0;Q<f.length;Q++){if(!i)v=c;for(var B=f[Q],r=0;r<B.length;r++){var n=B[r],p=n.nodeType==1&&n.tagName?n.tagName.toUpperCase():c;if(p!=c&&(p=="UL"||p=="OL"||p=="DL"||p==z||AjaxControlToolkit.HTMLEditor.isHeader(n)||p==o||p==D||p==H)){q(v);v=c;if(e!=C)if(p!=H&&!d)n.style.textAlign=e;if(d)n.style.margin=p==o?u:a;if(p=="UL"||p=="OL"||p=="DL"){for(var O=0;O<n.childNodes.length;O++){var J=n.childNodes.item(O);if(J.nodeType==1){J.style.textAlign=a;if(d)J.style.margin=J.tagName.toUpperCase()==o?u:a;for(var P=0;P<J.childNodes.length;P++){var I=J.childNodes.item(P);if(I.nodeType==1&&I.tagName){var N=I.tagName.toUpperCase();if(d)I.style.margin=N==o?u:a;if(N==z||N==o||AjaxControlToolkit.HTMLEditor.isHeader(I))if(j.tryUnWrap(I,h,d))m=g}}}}if(e==s&&d)n.style.textAlign=a;continue}else if(p==D){if(e!=C)if(!(e==s&&d)||n.parentNode.style.textAlign.length>0)n.style.textAlign=e;else n.style.textAlign=a;if(d)n.style.margin=p==o?u:a;for(var t=n.parentNode,w=[],F=0;F<t.childNodes.length;F++)t.childNodes.item(F).nodeType==1&&w.push(t.childNodes.item(F).style.textAlign);for(var A=1;A<w.length;A++)if(w[A-1]!=w[A])break;if(A==w.length){for(var L=w[0]==s&&d?a:w[0],r=0;r<t.childNodes.length;r++)if(t.childNodes.item(r).nodeType==1){t.childNodes.item(r).style.textAlign=a;if(d)t.childNodes.item(r).style.margin=t.childNodes.item(r).tagName.toUpperCase()==o?u:a}t.style.textAlign=L}continue}else if(p==H)if(e!=C)if(!(e==s&&d))n.align=e;else{n.align=a;n.removeAttribute(y)}if((p==z||p==o||AjaxControlToolkit.HTMLEditor.isHeader(n))&&e==s&&d)if(j.tryUnWrap(n,h,d))m=g;if((p==z||p==o||AjaxControlToolkit.HTMLEditor.isHeader(n))&&i&&l.toUpperCase()!=p){for(var E=j._doc.createElement(l),M=n.attributes,K=0;K<M.length;++K){var G=M.item(K);if(!G.specified)continue;if(G.name.toLowerCase()=="style")continue;E.setAttribute(G.name,G.value)}E.style.cssText=n.style.cssText;while(n.firstChild)E.appendChild(n.firstChild);n.parentNode.insertBefore(E,n);n.parentNode.removeChild(n)}}else if(!(e==s&&d)||i){if(v==c){v=j._doc.createElement(i?l:j.dfltBlockElement);if(j.dfltBlockElement.toUpperCase()==o&&!i)v.style.margin=u;if(!i)v.style.textAlign=e;n.parentNode.insertBefore(v,n)}var R=B[B.length-1]==h[1]?B.length-1:B.length,S=B[0]==h[0]?1:0;if(p=="BR"&&r==R-1&&r==S)if(AjaxControlToolkit.HTMLEditor.isIE){v.appendChild(j._doc.createTextNode(String.fromCharCode(160)));n.parentNode.removeChild(n)}else v.appendChild(n);else if(p=="BR"&&r==R-1&&r>S&&(!i||n.nextSibling!=c&&n.nextSibling==h[1]))n.parentNode.removeChild(n);else v.appendChild(n);if(p=="BR"&&r==B.length-1&&!i){q(v);v=c}if(n==h[1]&&r==B.length-1){q(v);v=c}}}}}for(var s=0;s<r.length;s++){var n=r[s];if(n.length>0){if(n[0].parentNode!=b){f.length>0&&t();f=[];b=n[0].parentNode}f.push(n)}}f.length>0&&t();o.setSelectionAfterOperation(h,m)};AjaxControlToolkit.HTMLEditor.MSIE_indent=function(s){var h="px",a="",e="P",c=null,m=this,p=m.get_paragraphs(),i=m.getSelectionAfterOperation(p),b=c,f=[],d=m,k=false;function j(a){if(a.nodeType==1){var b=!d.rtlState()?a.style.marginLeft:a.style.marginRight;if(b.length>0)return parseInt(b)}return 0}function g(c,b){if(c.nodeType==1){if(c.tagName.toUpperCase()==e&&b==a)b="0px";if(!d.rtlState())c.style.marginLeft=b;else c.style.marginRight=b}}function n(b){if(s)g(b,j(b)+40+h);else if(b.tagName.toUpperCase()==e)if(j(b)>=40)g(b,j(b)-40+h);else g(b,"0px");else if(j(b)>40)g(b,j(b)-40+h);else g(b,a)}function o(a){if(a!=c)if(a.childNodes==1&&(a.firstChild==i[0]||a.firstChild==i[1])){a.parentNode.insertBefore(a.firstChild,a);a.parentNode.removeChild(a)}}function r(){var z="LI",y="DIV",B="right",A="left",u="align",N=b.firstChild,O=b.lastChild;if(b.tagName&&!AjaxControlToolkit.HTMLEditor.isInlineElement(b)&&f[0][0]==N&&f[f.length-1][f[f.length-1].length-1]==O){var m=a;if(b.getAttribute(u)&&b.getAttribute(u).length>0)m=b.getAttribute(u);if(b.align&&b.align.length>0)m=b.align;if(b.style.textAlign&&b.style.textAlign.length>0)m=b.style.textAlign;if(m.toLowerCase()==A&&!d.rtlState()||m.toLowerCase()==B&&d.rtlState())m=a;b.align=a;b.setAttribute(u,a);b.removeAttribute(u);n(b);var E=b.tagName.toUpperCase();if((E==y||E==e||AjaxControlToolkit.HTMLEditor.isHeader(b))&&m==a){if(d.tryUnWrap(b,i))k=true}else{if(m!=a||E==z&&b.parentNode.style.textAlign.length>0)b.style.textAlign=m;else b.style.textAlign=a;if(E==z){for(var v=b.parentNode,r=[],D=0;D<v.childNodes.length;D++)r.push(j(v.childNodes.item(D)));for(var w=1;w<r.length;w++)if(r[w-1]!=r[w])break;if(w==r.length){for(var M=r[0]==0?a:r[0]+h,q=0;q<v.childNodes.length;q++)g(v.childNodes.item(q),a);g(v,M)}}}}else for(var I=0;I<f.length;I++)for(var t=c,x=f[I],q=0;q<x.length;q++){var l=x[q],p=l.nodeType==1&&l.tagName?l.tagName.toUpperCase():c;if(p!=c&&(p=="UL"||p=="OL"||p=="DL"||p==y||AjaxControlToolkit.HTMLEditor.isHeader(l)||p==e||p==z)){o(t);t=c;n(l);if(p=="UL"||p=="OL"||p=="DL"){for(var G=0;G<l.childNodes.length;G++){var F=l.childNodes.item(G);if(F.nodeType==1){g(F,a);for(var H=0;H<F.childNodes.length;H++){var C=F.childNodes.item(H),m=C.nodeType==1?l.style.textAlign:a;if(m.toLowerCase()==A&&!d.rtlState()||m.toLowerCase()==B&&d.rtlState())m=a;if(C.nodeType==1){g(C,a);if(m==a&&C.tagName){var K=C.tagName.toUpperCase();if(K==y||K==e)if(d.tryUnWrap(C,i))k=true}}}}}continue}else if(p==z){for(var v=l.parentNode,r=[],D=0;D<v.childNodes.length;D++)r.push(j(v.childNodes.item(D)));for(var w=1;w<r.length;w++)if(r[w-1]!=r[w])break;if(w==r.length){for(var M=r[0]==0?a:r[0]+h,q=0;q<v.childNodes.length;q++)g(v.childNodes.item(q),a);g(v,M)}continue}var m=l.style.textAlign;if(m.toLowerCase()==A&&!d.rtlState()||m.toLowerCase()==B&&d.rtlState())m=a;if((p==y||p==e||AjaxControlToolkit.HTMLEditor.isHeader(l))&&m==a)if(d.tryUnWrap(l,i))k=true}else if(s){if(t==c){t=d._doc.createElement(d.dfltBlockElement);if(d.dfltBlockElement.toUpperCase()==e)t.style.margin="0px";n(t);l.parentNode.insertBefore(t,l)}var J=x[x.length-1]==i[1]?x.length-1:x.length,L=x[0]==i[0]?1:0;if(p=="BR"&&q==J-1&&q==L)if(AjaxControlToolkit.HTMLEditor.isIE){t.appendChild(d._doc.createTextNode(String.fromCharCode(160)));l.parentNode.removeChild(l)}else t.appendChild(l);else if(p=="BR"&&q==J-1&&q>L)l.parentNode.removeChild(l);else t.appendChild(l);if(p=="BR"&&q==x.length-1){o(t);t=c}if(l==i[1]&&q==x.length-1){o(t);t=c}}}}for(var q=0;q<p.length;q++){var l=p[q];if(l.length>0){if(l[0].parentNode!=b){f.length>0&&r();f=[];b=l[0].parentNode}f.push(l)}}f.length>0&&r();m.setSelectionAfterOperation(i,k)};AjaxControlToolkit.HTMLEditor.getSelectionAfterOperation=function(a){if(a.length==0)return [];var e=this._doc.createElement("SPAN"),d=this._doc.createElement("SPAN"),f=a[0][0],b=a[a.length-1][a[a.length-1].length-1];if(f==b&&b.nodeType==1&&b.childNodes.length==0&&AjaxControlToolkit.HTMLEditor.canHaveChildren(b)){b.appendChild(e);b.appendChild(d)}else{var g=AjaxControlToolkit.HTMLEditor._getReallyFirst(f);g.parentNode.insertBefore(e,g);if(g==f){var h=[];h.push(e);for(var i=0;i<a[0].length;i++)h.push(a[0][i]);a[0]=h}var c=AjaxControlToolkit.HTMLEditor._getReallyLast(b);if(c.nextSibling)c.parentNode.insertBefore(d,c.nextSibling);else c.parentNode.appendChild(d);c==b&&a[a.length-1].push(d)}return [e,d]};AjaxControlToolkit.HTMLEditor.setSelectionAfterOperation=function(m,p){var a=null,c=this;if(m.length==0)return;var d=m[0],b=m[1],g=c._getSelection(),f=a,j=a;if(AjaxControlToolkit.HTMLEditor.isIE){g.empty();g=c._getSelection();var h=c._createRange(g),l=c._createRange(g);try{if(d!=a&&b!=a&&d.nextSibling==b){f=c._doc.createTextNode(" ");b.parentNode.insertBefore(f,b)}c._TcurrentFormat=a;d!=a&&h.moveToElementText(d);b!=a&&l.moveToElementText(b);if(d!=a&&b!=a){h.setEndPoint("EndToStart",l);h.select();if(f!=a){h.collapse(false);h.select();f.parentNode.removeChild(f)}}else if(d!=a)h.select();else b!=a&&l.select()}catch(r){}}else try{var e,i=d.nextSibling,q=b.previousSibling;c._TcurrentFormat=a;if(i==q&&i.nodeType==1&&i.tagName.toUpperCase()=="BR"){var o=AjaxControlToolkit.HTMLEditor.__getIndex(i);e=c._doc.createRange();e.setStart(i.parentNode,o);e.setEnd(i.parentNode,o)}else{f=c._doc.createTextNode("");j=c._doc.createTextNode("");d.parentNode.insertBefore(f,d);b.parentNode.insertBefore(j,b);e=c._doc.createRange();e.setStart(f,0);e.setEnd(j,0)}c._removeAllRanges(g);c._selectRange(g,e)}catch(r){}var n=AjaxControlToolkit.HTMLEditor._commonTotalParent(d==a?b:d,b==a?d:b),k=a;if(n!=a)k=n.parent;d!=a&&d.parentNode.removeChild(d);b!=a&&b.parentNode.removeChild(b);if(p&&k!=a){AjaxControlToolkit.HTMLEditor.spanJoiner(k,c._doc);if(!AjaxControlToolkit.HTMLEditor.isIE&&f!=a&&j!=a){var e=c._doc.createRange();e.setStart(f,0);e.setEnd(j,0);c._removeAllRanges(g);c._selectRange(g,e)}}};AjaxControlToolkit.HTMLEditor.get_paragraphs=function(){var a=this;a._TcurrentFormat=null;var b=a.getPseudoP();if(b.length==0)try{var e="<span id='"+AjaxControlToolkit.HTMLEditor.smartClassName+"_ll'></span><span id='"+AjaxControlToolkit.HTMLEditor.smartClassName+"_rr'></span><br>";a.insertHTML(e);var c=a._doc.getElementById(AjaxControlToolkit.HTMLEditor.smartClassName+"_ll"),d=a._doc.getElementById(AjaxControlToolkit.HTMLEditor.smartClassName+"_rr"),f=a._TcurrentFormat;a._TcurrentFormat=null;a.setSelectionAfterOperation([c,d],false);a._TcurrentFormat=f;b=a.getPseudoP()}catch(g){}return b};AjaxControlToolkit.HTMLEditor.getPseudoP=function(){var y="<span id='",n="SPAN",c=null,d=this,s=[];try{var l=d._getSelection(),j=d._createRange(l),q=AjaxControlToolkit.HTMLEditor.smartClassName+"_right",v=AjaxControlToolkit.HTMLEditor.smartClassName+"_left",h=c,g=c;if(AjaxControlToolkit.HTMLEditor.isIE){if(l.type.toLowerCase()!="control"){h=j.duplicate();g=j.duplicate();h.setEndPoint("EndToStart",j);g.setEndPoint("StartToEnd",j)}}else{h=j.cloneRange();g=j.cloneRange();h.setEnd(h.startContainer,h.startOffset);g.setStart(g.endContainer,g.endOffset)}var a=c,b=c;if(AjaxControlToolkit.HTMLEditor.isIE&&l.type.toLowerCase()=="control"){var o=j.item(0),i;i=d._doc.createElement(n);i.id=v;o.parentNode.insertBefore(i,o);i=d._doc.createElement(n);i.id=q;if(o.nextSibling==c)o.parentNode.appendChild(i);else o.parentNode.insertBefore(i,o.nextSibling)}else{if(!d.insertHTML(y+q+"'/>",g))return [];if(!d.insertHTML(y+v+"'/>",h)){var x=d._doc.getElementById(q);if(x!=c){p=x.parentNode;p.removeChild(x)}return []}}a=d._doc.getElementById(v);b=d._doc.getElementById(q);if(a!=c&&b!=c)while(a.nextSibling==c)if(a.parentNode.nextSibling)a.parentNode.parentNode.insertBefore(a,a.parentNode.nextSibling);else a.parentNode.parentNode.appendChild(a);if(a!=c&&b!=c){while(b.previousSibling==c)b.parentNode.parentNode.insertBefore(b,b.parentNode);if(b.previousSibling.nodeType==1){var A=b.previousSibling.tagName.toUpperCase();if(A!="BR"&&A!="IMG"){var t=AjaxControlToolkit.HTMLEditor._getReallyLast(b.previousSibling);if(t.nodeType==1&&AjaxControlToolkit.HTMLEditor.canHaveChildren(t))t.appendChild(b);else t.parentNode.appendChild(b)}}b.previousSibling&&b.previousSibling.nodeType==1&&b.previousSibling.tagName.toUpperCase()=="BR"&&b.parentNode.insertBefore(b,b.previousSibling)}if(a==c){var f=d._doc.createElement(n);f.id=v;b.parentNode.insertBefore(f,b);a=f}if(b==c){var f=d._doc.createElement(n);f.id=q;if(a.nextSibling)a.parentNode.insertBefore(f,a.nextSibling);else a.parentNode.appendChild(f);b=f}if(a!=c&&b!=c)if(a.parentNode==b)b.parentNode.insertBefore(a,b);else if(b.parentNode==a)if(a.nextSibling!=c)a.parentNode.insertBefore(b,a.nextSibling);else a.parentNode.appendChild(b);while(a.nextSibling!=c&&a.nextSibling.nodeType==3&&(""+a.nextSibling.data+"").length==0)a.parentNode.removeChild(a.nextSibling);if(d._TcurrentFormat==c&&a!=c&&b!=c&&a.nextSibling==b){var k=b.parentNode;d._TcurrentFormat=c;while(k&&k.tagName.toUpperCase()!="BODY"&&AjaxControlToolkit.HTMLEditor.isStyleTag(k.tagName)){if(k.tagName.toUpperCase()!="A"){var p=k.cloneNode(false);if(d._TcurrentFormat==c)d._TcurrentFormat=p;else{p.appendChild(d._TcurrentFormat);d._TcurrentFormat=p}}k=k.parentNode}if(d._TcurrentFormat){var C=d._doc.createElement("span");C.appendChild(d._TcurrentFormat);d._TcurrentFormat=C.innerHTML}}var e=a;while(e&&e.tagName&&AjaxControlToolkit.HTMLEditor.isStyleTag(e.tagName)&&e.tagName.toUpperCase()!="A")e=e.parentNode;if(e!=c&&e.tagName.toUpperCase()=="P")if(e.firstChild!=c)e.insertBefore(a,e.firstChild);else e.appendChild(a);else AjaxControlToolkit.HTMLEditor.positionInParagraph(a,a.previousSibling,true,a.parentNode);e=b;while(e&&e.tagName&&AjaxControlToolkit.HTMLEditor.isStyleTag(e.tagName)&&e.tagName.toUpperCase()!="A")e=e.parentNode;if(e!=c&&e.tagName.toUpperCase()=="P")e.appendChild(b);else AjaxControlToolkit.HTMLEditor.positionInParagraph(b,b.nextSibling,false,b.parentNode);s=d.getPseudoP_Recur(a,b,0);var z=a.parentNode.tagName.toUpperCase();if(s.length==0&&a.previousSibling==c&&b.nextSibling==c&&a.nextSibling==b&&(z=="P"||llpTagName=="DIV"||z=="LI"))s=[[a.parentNode]];if(AjaxControlToolkit.HTMLEditor.isIE){l.empty();l=d._getSelection();var r=d._createRange(l),w=d._createRange(l);try{a!=c&&r.moveToElementText(a);b!=c&&w.moveToElementText(b);if(a!=c&&b!=c){r.setEndPoint("EndToEnd",w);r.select()}else if(a!=c)r.select();else b!=c&&w.select()}catch(E){}}a!=c&&a.parentNode.removeChild(a);b!=c&&b.parentNode.removeChild(b)}catch(E){for(var B=d._doc.getElementsByTagName(n),u=[],m=0;m<B.length;m++){var f=B[m];if(f.id&&f.id.length>0){var D=new RegExp(AjaxControlToolkit.HTMLEditor.smartClassName,"ig");D.test(f.id)&&u.push(f)}}for(var m=0;m<u.length;m++)u[m].parentNode.removeChild(u[m])}return s};AjaxControlToolkit.HTMLEditor.getPseudoP_Recur=function(u,p,t){var A="span",K="_left_",J="_right_",I="TABLE",z=true,k=null,r=this,n=[],b=u,h=p.nextSibling!=k&&p.nextSibling.tagName&&p.nextSibling.tagName.toUpperCase()=="BR"?p.nextSibling:p,j=k;if(b==k||h==k){if(b!=k)j=AjaxControlToolkit.HTMLEditor._commonTotalParent(b,b);if(h!=k)j=AjaxControlToolkit.HTMLEditor._commonTotalParent(h,h)}else j=AjaxControlToolkit.HTMLEditor._commonTotalParent(b,h);if(j!=k){b=AjaxControlToolkit.HTMLEditor.getContainer(j.parent.childNodes.item(j.indexFirst),b);h=AjaxControlToolkit.HTMLEditor.getContainer(j.parent.childNodes.item(j.indexLast),h);AjaxControlToolkit.HTMLEditor.unStyle(b);AjaxControlToolkit.HTMLEditor.unStyle(h);while(b.parentNode!=j.parent)b=b.parentNode;while(h.parentNode!=j.parent)h=h.parentNode;AjaxControlToolkit.HTMLEditor._moveTagsUp(b.nextSibling,h);j=k;if(u==k||p==k){if(u!=k)j=AjaxControlToolkit.HTMLEditor._commonTotalParent(u,u);if(p!=k)j=AjaxControlToolkit.HTMLEditor._commonTotalParent(p,p)}else j=AjaxControlToolkit.HTMLEditor._commonTotalParent(u,p);j!=k&&AjaxControlToolkit.HTMLEditor.spanJoiner(j.parent,r._doc,j.indexFirst,j.indexLast+1,z);function V(a){if(!AjaxControlToolkit.HTMLEditor.isInlineElement(a))return z;else if(a.tagName&&AjaxControlToolkit.HTMLEditor.isStyleTag(a.tagName)&&a.tagName.toUpperCase()!="A"&&!AjaxControlToolkit.HTMLEditor.isTempElement(a)){var b=a.firstChild;while(b!=k){nnnNext=b.nextSibling;var c=V(b);if(c)return z;b=nnnNext}}return false}var d=0,c=[],f=0;if(b.tagName&&h.tagName){var x=b.tagName.toUpperCase(),F=h.tagName.toUpperCase();if((x=="TD"||x=="TR")&&(F=="TD"||F=="TR")){while(b.tagName.toUpperCase()!=I)b=b.parentNode;h=b}else if((x=="DD"||x=="DT")&&(F=="DD"||F=="DT")){while(b.tagName&&b.tagName.toUpperCase()!="DL")b=b.parentNode;h=b}else if(x=="LI"&&F=="LI"){while(x!="UL"&&x!="OL"){b=b.parentNode;x=b.tagName?b.tagName.toUpperCase():k}h=b}}var l=u?u:p,m=p?p:u,a=b;while(z){if(!AjaxControlToolkit.HTMLEditor.isTempElement(a)){var Z=V(a);if(!Z){if(a.nodeType&&a.nodeType==3){var X=""+a.data+"";if(X.length==0||/^[\n\r]+$/.test(X)){var Y=a.nextSibling;a.parentNode.removeChild(a);if(a==h)break;a=Y;continue}}c[f]=a;f++}else if(a.tagName&&a.tagName.toUpperCase()=="BR"){c[f]=a;n[d]=c;d++;c=[];f=0}else if((a==h||a==b)&&!(a==h&&a==b?AjaxControlToolkit.HTMLEditor._reallyFirst(a,l)&&AjaxControlToolkit.HTMLEditor._reallyLast(a,m):AjaxControlToolkit.HTMLEditor._reallyFirst(a,l)||AjaxControlToolkit.HTMLEditor._reallyLast(a,m))){var G=a.tagName?a.tagName.toUpperCase():k;if(G==I||G=="TBODY"){var s=a;while(s.tagName.toUpperCase()!=I)s=s.parentNode;for(var R=0,L=0,S=s.rows.item(s.rows.length-1).cells.length-1,M=s.rows.length-1,i=0;i<s.rows.length;i++)for(var W=s.rows.item(i),y=0;y<W.cells.length;y++){var q=W.cells.item(y);if(AjaxControlToolkit.HTMLEditor._lookChild(q,l)>=0){R=y;L=i}if(AjaxControlToolkit.HTMLEditor._lookChild(q,m)>=0){S=y;M=i}}for(var i=L;i<=M;i++)for(var y=i==L?R:0;y<=(i==M?S:s.rows.item(i).cells.length-1);y++){var q=s.rows.item(i).cells.item(y);if(f>0){n[d]=c;d++;c=[];f=0}var B=AjaxControlToolkit.HTMLEditor._lookChild(q,l)>=0,C=AjaxControlToolkit.HTMLEditor._lookChild(q,m)>=0;if(B||C){var e=l,g=m,Q=AjaxControlToolkit.HTMLEditor.smartClassName+J+t,P=AjaxControlToolkit.HTMLEditor.smartClassName+K+t;if(B){g=r._doc.createElement(A);g.id=Q;q.appendChild(g)}if(C){e=r._doc.createElement(A);e.id=P;if(q.firstChild)q.insertBefore(e,q.firstChild);else q.appendChild(e)}for(var D=r.getPseudoP_Recur(e,g,t+1),v=0;v<D.length;v++){n[d]=D[v];d++}e!=l&&e.parentNode.removeChild(e);g!=m&&g.parentNode.removeChild(g)}else{for(var N=0,O=q.childNodes.length,w=N;w<O;w++){var E=q.childNodes.item(w);if(!AjaxControlToolkit.HTMLEditor.isTempElement(E)){c[f]=E;f++}}if(c.length>0){n[d]=c;d++;c=[];f=0}}}}else if(G=="UL"||G=="OL"||G=="DL"){for(var H=a,T=0,U=H.childNodes.length-1,i=0;i<H.childNodes.length;i++){var o=H.childNodes.item(i);if(o.nodeType==1){if(o==l||AjaxControlToolkit.HTMLEditor._lookChild(o,l)>=0)T=i;if(o==m||AjaxControlToolkit.HTMLEditor._lookChild(o,m)>=0)U=i}}for(var i=T;i<=U;i++){var o=H.childNodes.item(i);if(f>0){n[d]=c;d++;c=[];f=0}var B=AjaxControlToolkit.HTMLEditor._lookChild(o,l)>=0,C=AjaxControlToolkit.HTMLEditor._lookChild(o,m)>=0;if(B||C){var e=l,g=m,Q=AjaxControlToolkit.HTMLEditor.smartClassName+J+t,P=AjaxControlToolkit.HTMLEditor.smartClassName+K+t;if(B){g=r._doc.createElement(A);g.id=Q;o.appendChild(g)}if(C){e=r._doc.createElement(A);e.id=P;if(o.firstChild)o.insertBefore(e,o.firstChild);else o.appendChild(e)}for(var D=r.getPseudoP_Recur(e,g,t+1),v=0;v<D.length;v++){n[d]=D[v];d++}e!=l&&e.parentNode.removeChild(e);g!=m&&g.parentNode.removeChild(g)}else{for(var N=0,O=o.childNodes.length,w=N;w<O;w++){var E=o.childNodes.item(w);if(!AjaxControlToolkit.HTMLEditor.isTempElement(E)){c[f]=E;f++}}if(c.length>0){n[d]=c;d++;c=[];f=0}}}}else{var B=AjaxControlToolkit.HTMLEditor._lookChild(a,l)>=0,C=AjaxControlToolkit.HTMLEditor._lookChild(a,m)>=0;if(f>0){n[d]=c;d++;c=[];f=0}if(B||C){var e=l,g=m,Q=AjaxControlToolkit.HTMLEditor.smartClassName+J+t,P=AjaxControlToolkit.HTMLEditor.smartClassName+K+t;if(B){g=r._doc.createElement(A);g.id=Q;a.appendChild(g)}if(C){e=r._doc.createElement(A);e.id=P;if(a.firstChild)a.insertBefore(e,a.firstChild);else a.appendChild(e)}for(var D=r.getPseudoP_Recur(e,g,t+1),v=0;v<D.length;v++){n[d]=D[v];d++}e!=l&&e.parentNode.removeChild(e);g!=m&&g.parentNode.removeChild(g)}else{for(var N=0,O=a.childNodes.length,w=N;w<O;w++){var E=a.childNodes.item(w);if(!AjaxControlToolkit.HTMLEditor.isTempElement(E)){c[f]=E;f++}}if(c.length>0){n[d]=c;d++;c=[];f=0}}}}else{if(f>0){n[d]=c;d++;c=[];f=0}c[f]=a;n[d]=c;d++;c=[];f=0}}if(a==h)break;a=a.nextSibling}if(f>0)n[d]=c}return n};AjaxControlToolkit.HTMLEditor.unWrap=function(a,f){var d="BR",e=this;if(a.firstChild){while(a.firstChild&&a.firstChild.nodeType==3&&""+a.firstChild.data+""=="")a.removeChild(a.firstChild);var b=[];while(a.firstChild){a.firstChild!=f[0]&&a.firstChild!=f[1]&&b.push(a.firstChild);a.parentNode.insertBefore(a.firstChild,a)}if(b.length==0){var g=e._doc.createElement(d);a.parentNode.insertBefore(g,a)}if(AjaxControlToolkit.HTMLEditor.isIE&&b.length==1&&b[0].nodeType==3){var h=""+b[0].data+"";if(h.length==1&&h.charCodeAt(0)==160){var g=e._doc.createElement(d);b[0].parentNode.insertBefore(g,b[0]);b[0].parentNode.removeChild(b[0])}}while(a.nextSibling&&a.nextSibling.nodeType==3&&""+a.nextSibling.data+""=="")a.parentNode.removeChild(a.nextSibling);var c=a.previousSibling&&f[1]==a.previousSibling?f[1].previousSibling:a.previousSibling;if(c&&AjaxControlToolkit.HTMLEditor.isInlineElement(c))if(c.nodeType==1&&c.childNodes.length>0)c=AjaxControlToolkit.HTMLEditor._getReallyLast(c);if(AjaxControlToolkit.HTMLEditor.isInlineElement(c)&&a.nextSibling!=null){var g=e._doc.createElement(d);a.parentNode.insertBefore(g,a)}}else{var g=e._doc.createElement(d);a.parentNode.insertBefore(g,a)}a.parentNode.removeChild(a)};AjaxControlToolkit.HTMLEditor.tryUnWrap=function(b,m,e){var g="undefined",l=this;b.style.textAlign="";for(var h=0,i=b.attributes,f=0;f<i.length;++f){var j=i.item(f);if(!j.specified)continue;if(j.name.toLowerCase()=="style")continue;h++}var k=b.style.cssText,d=0,a,c=b.tagName.toUpperCase();if(!(typeof e!=g&&e))if(c!="LI")try{a=parseInt(AjaxControlToolkit.HTMLEditor.getStyle(b,"margin-top"));if(isNaN(a))a=c=="P"?1:0;d+=a;a=parseInt(AjaxControlToolkit.HTMLEditor.getStyle(b,"margin-bottom"));if(isNaN(a))a=c=="P"?1:0;d+=a;a=parseInt(AjaxControlToolkit.HTMLEditor.getStyle(b,"margin-right"));if(isNaN(a))a=c=="P"?1:0;d+=a;a=parseInt(AjaxControlToolkit.HTMLEditor.getStyle(b,"margin-left"));if(isNaN(a))a=c=="P"?1:0;d+=a}catch(n){d=1}b.style.margin="";if(h==0&&b.style.cssText.length==0&&d==0||typeof e!=g&&e&&c!="LI"){l.unWrap(b,m);return true}else{b.style.cssText=k;return false}};AjaxControlToolkit.HTMLEditor._queryCommandValue=function(n,o){var e="font-size",l="font-family",g=null,d=this,f=d._rangeStartEnd();if(f==g)return "";try{if(n.toLowerCase()=="backcolor"){var i=f.start;while(i){var j=AjaxControlToolkit.HTMLEditor.getStyle(i,"background-color").toLowerCase();if(j.length>0&&j!="transparent")return j;i=i.parentNode}return "#FFFFFF"}var c="none";switch(n.toLowerCase()){case "forecolor":c="color";break;case "fontname":c=l;break;case "fontsize":c=e}var b;if((c==e||c==l)&&d._FontNotSet){b="";var a=f.start;while(a!=g){if(c==e){if(a.style&&a.style.fontSize&&a.style.fontSize.length>0){b=a.style.fontSize;break}else if(a.tagName&&a.tagName.toUpperCase()=="FONT"&&a.size&&a.size.length>0){b=AjaxControlToolkit.HTMLEditor.fontSizeSeek(a.size);break}}else if(a.style&&a.style.fontFamily&&a.style.fontFamily.length>0){b=a.style.fontFamily;break}else if(a.tagName&&a.tagName.toUpperCase()=="FONT"&&a.face&&a.face.length>0){b=a.face;break}if(a.className&&a.className.length>0){b=AjaxControlToolkit.HTMLEditor.getStyle(a,c).toLowerCase();if(c==e)if(!AjaxControlToolkit.HTMLEditor.isIE)b=AjaxControlToolkit.HTMLEditor._TryTransformFromPxToPt(b,d,o);break}var h=a.tagName.toUpperCase();if(h=="BODY"||h=="TD")break;a=a.parentNode}}else{b=AjaxControlToolkit.HTMLEditor.getStyle(f.start,c).toLowerCase();if(c==e)if(!AjaxControlToolkit.HTMLEditor.isIE){b=AjaxControlToolkit.HTMLEditor._TryTransformFromPxToPt(b,d,o);var a=f.start;while(a!=g){if(a.style&&a.style.fontSize&&a.style.fontSize.length>0){b=a.style.fontSize;break}if(a.className&&a.className.length>0)break;var h=a.tagName.toUpperCase();if(h=="BODY"||h=="TD")break;a=a.parentNode}}}if(d._StyleForTyping!=g&&d._StyleForTyping.length>0)for(var k=0;k<d._StyleForTyping.length;k++){var m=d._StyleForTyping[k];if(m.name==c){b=m.value;break}}return b}catch(p){return ""}};