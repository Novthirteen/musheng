Type.registerNamespace("AjaxControlToolkit.HTMLEditor");AjaxControlToolkit.HTMLEditor.DesignPanel=function(d){var c=false,b=null,a=this;AjaxControlToolkit.HTMLEditor.DesignPanel.initializeBase(a,[d]);a._doc=b;a._updated_now=c;a._updateTimer=b;a._popup=b;a._contextElement=b;a._a_prize=c;a.__stack=b;a._StyleForTyping=b;a.isWord=c;a.isPlainText=c;a.dfltBlockElement="P";a._FontNotSet=true;a._design_timer1=b;a._events$delegate=Function.createDelegate(a,AjaxControlToolkit.HTMLEditor.DesignPanelEventHandler);a._blur$delegate=Function.createDelegate(a,a._blur);a._focus$delegate=Function.createDelegate(a,a._focus_event)};AjaxControlToolkit.HTMLEditor.DesignPanel.prototype={initialize:function(){AjaxControlToolkit.HTMLEditor.DesignPanel.callBaseMethod(this,"initialize")},dispose:function(){AjaxControlToolkit.HTMLEditor.DesignPanel.callBaseMethod(this,"dispose")},_activate:function(b){var a=this;AjaxControlToolkit.HTMLEditor.DesignPanel.callBaseMethod(a,"_activate");a._wasFocused=false;a._initIframe(b);a._onDocumentLoaded()},_deactivate:function(){var a=this;a._deactivateCommon();if(AjaxControlToolkit.HTMLEditor.isIE){a._doc.open();a._doc.write("");a._doc.close();a.get_element().src="javascript:false;"}a._doc=null;AjaxControlToolkit.HTMLEditor.DesignPanel.callBaseMethod(a,"_deactivate")},_deactivateCommon:function(){var a=this;a._editPanel.__blured=false;for(var c=a._doc.body.getElementsByTagName("IMG"),b=0;b<c.length;b++)if(c[b].getAttribute(AjaxControlToolkit.HTMLEditor.attachedIdAttribute)&&c[b].getAttribute(AjaxControlToolkit.HTMLEditor.attachedIdAttribute).length>0)try{if(AjaxControlToolkit.HTMLEditor.isIE)$removeHandler(c[b],"dragstart",AjaxControlToolkit.HTMLEditor.stopDrag);else $removeHandler(c[b],"draggesture",AjaxControlToolkit.HTMLEditor.stopDrag)}catch(d){}AjaxControlToolkit.HTMLEditor._removeEvents(a._doc,["keydown","keypress","mousedown","mouseup","dblclick"],a._events$delegate);AjaxControlToolkit.HTMLEditor._removeEvents(a.get_element().contentWindow,["blur"],a._blur$delegate);AjaxControlToolkit.HTMLEditor._removeEvents(a.get_element().contentWindow,["focus"],a._focus$delegate)},_initIframe:function(b){var a=this;if(!AjaxControlToolkit.HTMLEditor.isIE){a._savedValue=b;a._absAndFixedParents=a._getAbsAndFixedParents()}var c=AjaxControlToolkit.HTMLEditor.Trim(a._prepareContent(b));a._doc=a.get_element().contentWindow.document;if(!AjaxControlToolkit.HTMLEditor.isIE)a._doc.designMode="on";a._doc.open();a._doc.write('<html><head><link rel="stylesheet" href="'+a._editPanel.get_documentCssPath()+'" media="all" /><link rel="stylesheet" href="'+a._editPanel.get_designPanelCssPath()+'" media="all" /></head><body>'+c+"</body></html>");a._doc.close();a._doc.id="EditorDocument";if(AjaxControlToolkit.HTMLEditor.isIE){a._doc.body.contentEditable=true;a._tryForward=true}},_blur:function(b){var a=this;a._editPanel.__blured=true;if(!AjaxControlToolkit.HTMLEditor.isIE&&a._design_timer1!=null){clearTimeout(a._design_timer1);a._design_timer1=null}!a.isPopup&&a._editPanel._validate(b,null);return true},_focus_event:function(){var a=this;a._editPanel.__blured=false;if(AjaxControlToolkit.HTMLEditor.isIE)a._really_focused();else{var b=a;AjaxControlToolkit.HTMLEditor.LastFocusedEditPanel=a._editPanel;if(a._design_timer1==null)a._design_timer1=setTimeout(function(){b._really_focused();b._design_timer1=null},0)}return true},_getAbsAndFixedParents:function(){var a=this.get_element(),b="";while(a!=null&&a.tagName&&a.tagName.toLowerCase()!="body"){b+=a.tagName;if(a.style.position=="absolute"||a.style.position=="fixed")b+=": "+a.style.position;b+="\n";a=a.parentNode}return b},_onDocumentLoaded:function(){var a=this,b=a;if(!AjaxControlToolkit.HTMLEditor.isIE){var c=a._getAbsAndFixedParents();if(c!=a._absAndFixedParents){a._initIframe(a._savedValue);setTimeout(function(){b._onDocumentLoaded()},10);return}}try{if(!AjaxControlToolkit.HTMLEditor.isIE){a._doc.queryCommandValue("forecolor");if(AjaxControlToolkit.HTMLEditor.isSafari||AjaxControlToolkit.HTMLEditor.isOpera)if(!AjaxControlToolkit.HTMLEditor.isReallyVisible(a.get_element())){setTimeout(function(){b._onDocumentLoaded()},10);return}}var d=b._doc.body.innerHTML}catch(e){setTimeout(function(){b._onDocumentLoaded()},10);return}a._afterBodyIsFormed();setTimeout(function(){b._activateFinished();AjaxControlToolkit.HTMLEditor.isIE&&!b._editPanel.get_autofocus()&&b._getSelection().empty()},0)},_afterBodyIsFormed:function(){var b=this,d=b;AjaxControlToolkit.HTMLEditor._addEvents(b._doc,["keydown","keypress","mousedown","mouseup","dblclick"],b._events$delegate);AjaxControlToolkit.HTMLEditor._addEvents(b.get_element().contentWindow,["blur"],b._blur$delegate);AjaxControlToolkit.HTMLEditor._addEvents(b.get_element().contentWindow,["focus"],b._focus$delegate);AjaxControlToolkit.HTMLEditor.inspectForShadows(d._doc.body);var a=b._doc.body;if(a.childNodes.length==1&&a.firstChild.tagName&&a.firstChild.tagName.toUpperCase()=="DIV"&&a.firstChild.style.cssText.length>0&&a.firstChild.style.direction.length>0&&AjaxControlToolkit.HTMLEditor.getStyle(a.firstChild,"position")!="absolute"){a.style.cssText=a.firstChild.style.cssText;var c=a.firstChild;while(c.firstChild)a.insertBefore(c.firstChild,c);a.removeChild(c)}d._clearP()},_getContent:function(){var v="pseudomode",u="dummybgcolor",t="dummysrc",s="dummytag",f="$1$3",r="$1<br/>$3",b=this;if(b._popup!=null)if(typeof b._popup._forceImClose=="function"){var y=b._popup._forceImClose;y(b._popup._iframe.contentWindow)}b._clearP();var a;if(AjaxControlToolkit.HTMLEditor.isIE){AjaxControlToolkit.HTMLEditor.spanJoiner(b._doc.body,b._doc);a=AjaxControlToolkit.HTMLEditor.getHTML(b._doc.body,false,true);a=a.replace(/(<td[^>]*?>)([\s ]*?)(<\/td[^>]*?>)/ig,"$1&nbsp;$3").replace(/(<td[^>]*?>)\s*(&nbsp;)\s*(<\/td[^>]*?>)/ig,r).replace(/(<p[^>]*?>)\s*(&nbsp;)\s*(<\/p[^>]*?>)/ig,r);a=(b._doc.body.style.cssText.length>0?'<div style="'+b._doc.body.style.cssText.replace('"',"'")+'">':"")+a+(b._doc.body.style.cssText.length>0?"</div>":"");if(b._editPanel.get_noScript())a=a.replace(/(<script(?:[^>]*?)>(?:[^<]*?)<\/script(?:[^>]*?)>)/gi,"");if(/<embed/ig.test(a))a=a.replace(/(<embed(?:.*?))(\sloop=\"true\")((?:.*?)>)/ig,f).replace(/(<embed(?:.*?))(\splay=\"true\")((?:.*?)>)/ig,f).replace(/(<embed(?:.*?))(\sbgcolor=\"\")((?:.*?)>)/ig,f).replace(/(<embed(?:.*?))(\sscale=\"\")((?:.*?)>)/ig,f).replace(/(<embed(?:.*?))(\shspace=\"0\")((?:.*?)>)/ig,f).replace(/(<embed(?:.*?))(\svspace=\"0\")((?:.*?)>)/ig,f).replace(/(<embed(?:.*?))(\swmode=\"[^\"]+\")((?:.*?)>)/ig,f).replace(/(<embed(?:.*?))(pseudomode=)(\"[^\"]*\")((?:.*?)>)/ig,"$1wmode=$3$4").replace(/(<embed(?:.*?))(\swmode=\"\")((?:.*?)>)/ig,f);var x=new RegExp("(<[/]?)(teo"+AjaxControlToolkit.HTMLEditor.smartClassName+":)","ig");a=a.replace(x,"$1")}else{var h=b._doc.createElement("DIV"),q=new AjaxControlToolkit.HTMLEditor.DesignPanel.ScriptRecover;h.style.cssText=b._doc.body.style.cssText;!b._editPanel.get_noScript()&&b._doc.body.innerHTML.replace(/<script(?:[^>]*?)>(.*?)<\/script(?:[^>]*?>)/gi,function(a,b){return q.regReplScript1(a,b)});h.innerHTML=AjaxControlToolkit.HTMLEditor.Trim(b._doc.body.innerHTML);for(var p=h.getElementsByTagName("IMG"),l=[],i=0;i<p.length;i++)l.push(p[i]);for(var o=0;o<l.length;o++){var c=l[o],k;k=c.getAttribute(s);if(k&&k.length>0&&k.toLowerCase()=="embed"){var z=c.getAttribute(t),j=c.getAttribute(u),m=c.getAttribute(v),w=c.attributes,e=b._doc.createElement("EMBED");e.src=z;e.width=c.width;e.height=c.height;if(j&&j.length>0){j=AjaxControlToolkit.HTMLEditor.tryReplaceRgb(j);e.setAttribute("bgcolor",j)}m&&m.length>0&&e.setAttribute("wmode",m);for(var i=0;i<w.length;++i){var n=w.item(i);if(!n.specified)continue;var d=n.name.toLowerCase(),g=n.value;if(d==s||d==t||d==u||d=="style"||d=="wmode"||d==v||d=="src")continue;if(d=="loop"&&g=="true")continue;if(d=="play"&&g=="true")continue;if(d=="hspace"&&g=="0")continue;if(d=="vspace"&&g=="0")continue;if(d=="scale"&&g.length==0)continue;if(d=="align"&&g.length==0)continue;e.setAttribute(d,g)}if(c.style.width&&c.style.width.length>0)e.style.width=c.style.width;if(c.style.height&&c.style.height.length>0)e.style.height=c.style.height;c.parentNode.insertBefore(e,c);c.parentNode.removeChild(c)}}AjaxControlToolkit.HTMLEditor.spanJoiner(h,b._doc);a=AjaxControlToolkit.HTMLEditor.getHTML(h,h.style.cssText.length>0?true:false,true);if(!b._editPanel.get_noScript())a=a.replace(/(<script(?:[^>]*?)>)(.*?)(<\/script(?:[^>]*?)>)/gi,function(a,b,c,d){return q.regReplFromScript1(a,b,c,d)});else a=a.replace(/(<script(?:[^>]*?)>(?:[^<]*?)<\/script(?:[^>]*?)>)/gi,"");delete h}a=AjaxControlToolkit.HTMLEditor.brXHTML(a.replace(/^([\n|\r]+)/,""));if(b._editPanel.get_noUnicode())a=a.replace(/([\u0080-\uFFFF])/g,function(b,a){return "&#"+a.charCodeAt(0).toString(10)+";"});if(AjaxControlToolkit.HTMLEditor.Trim(a)=="<br />")a="";return a},_setContent:function(b){var a=this;a._deactivateCommon();var c=AjaxControlToolkit.HTMLEditor.Trim(a._prepareContent(b));a._doc.open();a._doc.write('<html><head><link rel="stylesheet" href="'+a._editPanel.get_documentCssPath()+'" media="all" /><link rel="stylesheet" href="'+a._editPanel.get_designPanelCssPath()+'" media="all" /></head><body>'+c+"</body></html>");a._doc.close();if(AjaxControlToolkit.HTMLEditor.isIE){a._doc.body.contentEditable=true;a._tryForward=true}a._afterBodyIsFormed();a._editPanel.get_autofocus()&&a._focus();AjaxControlToolkit.HTMLEditor.isIE&&!a._editPanel.get_autofocus()&&a._getSelection().empty()},_focus:function(a){this.focusEditor();this._focused(a)},focusEditor:function(){var a=this;try{a.get_element().contentWindow.focus()}catch(b){}if(!a._wasFocused){a._wasFocused=true;!a._editPanel.get_startEnd()&&a._setToEnd()}},_prepareContent:function(o){var m="$1&nbsp;$3",g=this,a=o;a=a.replace(/<object(?:[^>]*?)>(?:[^\u0000]*?)(<embed(?:[^>]*?)>)(?:[^\u0000]*?)<\/object(?:[^>]*?)>/gi,"$1");if(AjaxControlToolkit.HTMLEditor.isIE){a=AjaxControlToolkit.HTMLEditor.Trim(a.replace(/([\n\r]+<)/g,"<").replace(/([^>])([\n\r]+)([^<])/g,"$1 $3")).replace(/(&amp;)/g,"&amp;amp;").replace(/<br\s*[\/]*>\s*<\/td>/ig,"</td>").replace(/(<td[^>]*?>)([\s ]*?)(<\/td[^>]*?>)/ig,m).replace(/(<p[^>]*?>)\s*(<br[^>]*?>)\s*(<\/p[^>]*?>)/ig,m);if(/<embed/ig.test(a))a=a.replace(/(<embed(?:.*?))(wmode=)(\"[^\"]*\")((?:.*?)>)/ig,"$1pseudomode=$3$4").replace(/(<embed)([^>]*?>)/ig,'$1 wmode="transparent"$2');a=a.replace(/&amp;/ig,"&");return a}else{var i=new AjaxControlToolkit.HTMLEditor.DesignPanel.ScriptRecover,f=document.createElement("DIV");!g._editPanel.get_noScript()&&a.replace(/<script(?:[^>]*?)>(.*?)<\/script(?:[^>]*?>)/gi,function(a,b){return i.regReplScript1(a,b)});f.innerHTML=AjaxControlToolkit.HTMLEditor.Trim(a.replace(/([^>])([\n\r]+)([^<])/g,"$1 $3"));for(var l=f.getElementsByTagName("EMBED"),h=[],e=0;e<l.length;e++)h.push(l[e]);for(var k=0;k<h.length;k++){var b=h[k],c=document.createElement("IMG"),n=b.attributes;c.src=g._editPanel.get_imagePath_1x1();c.setAttribute("dummytag","embed");for(var e=0;e<n.length;++e){var j=n.item(e);if(!j.specified)continue;var d=j.name.toLowerCase(),o=j.value;if(d=="src")d="dummysrc";else if(d=="bgcolor")d="dummybgcolor";else if(d=="wmode")d="pseudomode";c.setAttribute(d,o)}c.style.cssText="border: 1px dotted #000000; background-image: url('"+(c.getAttribute("type").toLowerCase()=="application/x-mplayer2"?g._editPanel.get_imagePath_media():tthis._editPanel.get_imagePath_flash())+"'); background-position: center; background-repeat: no-repeat; background-color: #c0c0c0;";if(b.style.width&&b.style.width.length>0)c.style.width=b.style.width;if(b.style.height&&b.style.height.length>0)c.style.height=b.style.height;b.parentNode.insertBefore(c,b);b.parentNode.removeChild(b)}AjaxControlToolkit.HTMLEditor.spanJoiner(f,document);a=AjaxControlToolkit.HTMLEditor.Trim(AjaxControlToolkit.HTMLEditor.getHTML(f,false,true));if(!g._editPanel.get_noScript())a=a.replace(/(<script(?:[^>]*?)>)(.*?)(<\/script(?:[^>]*?)>)/gi,function(a,b,c,d){return i.regReplFromScript1(a,b,c,d)});delete f;delete i;a=AjaxControlToolkit.HTMLEditor.brXHTML(a);if(a.length==0)a="<br/>";return a}},_clearP:function(){var b=true;try{var a=this._doc.body;if(a.firstChild)if(a.firstChild.nodeType==3){var d=AjaxControlToolkit.HTMLEditor.Trim(""+a.firstChild.data+"");if(d.length==0)a.removeChild(a.firstChild);else if(d!=""+a.firstChild.data+"")a.firstChild.data=d}if(AjaxControlToolkit.HTMLEditor.isIE)if(a.childNodes.length==1){a=a.firstChild;if(a.nodeType==1){var c=a.tagName.toLowerCase();if(c=="p"||c=="ul"||c=="ol"){var f=false,g=c=="ul"||c=="ol";function e(a){var d=false;if(a.nodeType==1){var c=a.tagName.toUpperCase();if(!(g&&c=="LI"))if(AjaxControlToolkit.HTMLEditor.isRestricted(a)||c=="IMG"||c=="IFRAME"||c=="EMBED"||c=="SCRIPT")return b;if(a.childNodes.length>1)return b;if(a.childNodes.length==0)return false;d|=e(a.firstChild)}else if(a.nodeType==3)d|=b;return d}if(a.childNodes.length==1)if(!e(a.firstChild)){a.removeChild(a.firstChild);f=b}(f||a.parentNode.innerHTML.toLowerCase()=="<p>&nbsp;</p>")&&this._doc.body.removeChild(a)}}}}catch(h){}},isControl:function(){var b=false;try{var d=this._getSelection();if(AjaxControlToolkit.HTMLEditor.isIE)if(d.type.toLowerCase()=="control")return true;else return b;else{var a=this._createRange(d),c=this._getParent(a);if(c.nodeType!=3&&a.startContainer==a.endContainer){if(!c.tagName)return b;if(a.startContainer.childNodes.item(a.startOffset)==null)return b;if(a.startOffset==a.endOffset&&a.startContainer.childNodes.item(a.startOffset).tagName&&(a.startContainer.childNodes.item(a.startOffset).tagName.toUpperCase()=="BR"||AjaxControlToolkit.HTMLEditor.isStyleTag(a.startContainer.childNodes.item(a.startOffset).tagName)))return b;if(c.tagName.toUpperCase()=="BODY"&&a.startOffset==0&&a.endOffset>0&&a.endOffset==c.childNodes.length)return b;if(a.startOffset==a.endOffset&&a.startContainer.childNodes.item(a.startOffset).nodeType==3)return b;return true}else return b}}catch(e){return true}},isPopup:function(){return this._popup!=null},_getSelection:function(){var a=this;if(AjaxControlToolkit.HTMLEditor.isIE){var b=a._doc.selection;return b}else{a.focusEditor();var b,c,d,e=a.get_element().contentWindow;b=e.getSelection();c=a._createRange(b);d=c.startContainer;try{while(d&&d.nodeType)d=d.parentNode}catch(f){a._removeAllRanges(b);c=a._createRange(b);c.setStart(a._saved_startContainer,a._saved_startOffset);c.setEnd(a._saved_startContainer,a._saved_startOffset);a._selectRange(b,c);b=e.getSelection()}return b}},_createRange:function(b){var c="undefined",a=this;if(AjaxControlToolkit.HTMLEditor.isIE)if(typeof b==c)return a._doc.body.createTextRange();else return b.createRange();else{a.focusEditor();if(typeof b==c)return a._doc.createRange();else try{var d=b.getRangeAt(0);return d}catch(e){return a._doc.createRange()}}},toEndOfProtected:function(){var e=null,c=this,g=this._getSelection(),b;try{b=this._createRange(g)}catch(h){return false}var a;if(!AjaxControlToolkit.HTMLEditor.isIE){a=AjaxControlToolkit.HTMLEditor.contentEditable(b.startContainer);if(a==e)a=AjaxControlToolkit.HTMLEditor.contentEditable(b.endContainer)}else a=AjaxControlToolkit.HTMLEditor.contentEditable(AjaxControlToolkit.HTMLEditor.getSelParent(c));if(AjaxControlToolkit.HTMLEditor.isIE&&a!=e){try{b.remove(a)}catch(h){}b=c._doc.body.createControlRange();b.add(a);b.select()}else if(!AjaxControlToolkit.HTMLEditor.isIE&&a!=e){var f=c._getSelection(),d;if(a.nextSibling!=e&&a.nextSibling.nodeType==3)d=a.nextSibling;else{d=c._doc.createTextNode("");if(a.nextSibling!=e)a.parentNode.insertBefore(d,a.nextSibling);else a.parentNode.appendChild(d)}c._removeAllRanges(f);var b=c._createRange(f);b.setStart(d,0);b.setEnd(d,0);c._selectRange(f,b)}return true},_commonPaste:function(h){var c=null,d=this,a=d;d._saveContent();if(AjaxControlToolkit.HTMLEditor.isIE){d.openWait();setTimeout(function(){a._paste(!a._editPanel.get_noPaste());a.closeWait()},0);AjaxControlToolkit.HTMLEditor._stopEvent(h)}else if(!d.isPlainText&&!d.isWord&&!d._editPanel.get_noPaste())setTimeout(function(){AjaxControlToolkit.HTMLEditor.operateAnchors(a,a._doc,!a._editPanel.get_showAnchors());AjaxControlToolkit.HTMLEditor.operatePlaceHolders(a,a._doc,!a._editPanel.get_showPlaceHolders());AjaxControlToolkit.HTMLEditor.inspectForShadows(a._doc.body);a._checkImages(a._doc.body);a.onContentChanged()},0);else{var e=a._getSafePlace();if(e!=c){var b=a._doc.createElement("div");b.style.display="inline";b.style.borderStyle="none";e.parentNode.insertBefore(b,e);b.appendChild(e);b.removeChild(e);b.innerHTML="xx";var g=a._getSelection(),f=a._createRange();a._removeAllRanges(g);f.setStart(b.firstChild,0);f.setEnd(b.firstChild,1);a._selectRange(g,f);a.openWait();setTimeout(function(){var i=b.parentNode;b.lastChild.deleteData(b.lastChild.length-1,1);if(a.isWord){b.innerHTML=AjaxControlToolkit.HTMLEditor.cleanUp(b.innerHTML);AjaxControlToolkit.HTMLEditor.replaceOldTags(b,a);AjaxControlToolkit.HTMLEditor.spanJoiner(b,a._doc)}else{var g=document.createElement("div");g.innerHTML=AjaxControlToolkit.HTMLEditor.cleanUp(b.innerHTML);var j=new AjaxControlToolkit.HTMLEditor.jsDocument(true);AjaxControlToolkit.HTMLEditor.__MozillaGetInnerText(g,j);b.innerHTML=j.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"").replace(/\n/g,"<br/>").replace(/\t/g,"&nbsp;");delete g}while(b.firstChild)i.insertBefore(b.firstChild,b);var e=c,d=c;if(b.nextSibling&&b.nextSibling.nodeType==3&&b.previousSibling&&b.previousSibling.nodeType==3){e=b.nextSibling;d=b.previousSibling}i.removeChild(b);var f=c;if(e!=c&&d!=c){f=d.data.length;d.data=""+d.data+""+e.data+"";e.parentNode.removeChild(e)}a.isWord=false;a.isPlainText=false;a.closeWait();if(f!=c){var k=a._getSelection(),h=a._createRange();a._removeAllRanges(k);h.setStart(d,f);h.setEnd(d,f);a._selectRange(k,h)}a.onContentChanged()},0)}else AjaxControlToolkit.HTMLEditor._stopEvent(h)}},_selectRange:function(b,a){b.addRange(a);this.focusEditor()},_selectRng:function(a){var d="character",b=this,g=b._getSelection();if(!AjaxControlToolkit.HTMLEditor.isIE){var h=b._doc.createRange();h.setStart(a[0],0);h.setEnd(a[a.length-1],(""+a[a.length-1].data+"").length);b._removeAllRanges(g);b._selectRange(g,h)}else{var c=b._createRange(g),e=b._createRange(g),i=b._doc.createElement("span"),f=b._doc.createElement("span");a[0].parentNode.insertBefore(i,a[0]);if(a[a.length-1].nextSibling)a[a.length-1].parentNode.insertBefore(f,a[a.length-1].nextSibling);else a[a.length-1].parentNode.appendChild(f);try{c.moveToElementText(i);var j=c.moveStart(d,1);c.moveStart(d,-j);e.moveToElementText(f);j=e.moveEnd(d,-1);e.moveEnd(d,-j);c.setEndPoint("EndToEnd",e);c.select()}catch(k){}a[0].parentNode.removeChild(i);a[a.length-1].parentNode.removeChild(f)}},_removeAllRanges:function(a){a.removeAllRanges()},_setToEnd:function(){var a=this;setTimeout(function(){a._setToEnd_();a._editPanel.updateToolbar()},0)},_setToEnd_:function(){var a=this;if(AjaxControlToolkit.HTMLEditor.isIE){var f=a._getSelection(),d=a._createRange(f);if(f.type.toLowerCase()!="control"){d.moveEnd("textedit",1);d.collapse(false)}d.select();a.focusEditor();return}var e=0,b=a._doc.body,c=null;if(b.lastChild&&b.lastChild.nodeType==3){b=b.lastChild;e=(""+b.data+"").length}else{var g=a._doc.createTextNode("");if(b.lastChild&&b.lastChild.nodeType==1&&b.lastChild.tagName.toUpperCase()=="BR")b.insertBefore(g,b.lastChild);else b.appendChild(g);b=g;e=0}var f=a._getSelection();a._removeAllRanges(f);var d=a._createRange();d.setStart(b,e);d.setEnd(b,e);a._selectRange(f,d);c!=null&&a._doc.body.removeChild(c);a.focusEditor();if(!AjaxControlToolkit.HTMLEditor.isSafari&&!AjaxControlToolkit.HTMLEditor.isOpera)try{var c=a._doc.createElement("button");c.style.width="0px";c.style.height="20px";a._doc.body.appendChild(c);c.focus();c.blur();a.focusEditor();a._doc.body.removeChild(c)}catch(h){}},isShadowed:function(){var b=this;if(!b.isControl())return false;var e=b._getSelection(),a=b._createRange(e),c;if(AjaxControlToolkit.HTMLEditor.isIE)c=a.item(0);else c=a.startContainer.childNodes.item(a.startOffset);if(c.tagName&&c.tagName.toUpperCase()=="IMG"&&c.getAttribute(AjaxControlToolkit.HTMLEditor.attachedIdAttribute)&&c.getAttribute(AjaxControlToolkit.HTMLEditor.attachedIdAttribute).length>0){var d=b.getAttachedElement(c);if(d!=null){if(AjaxControlToolkit.HTMLEditor.isIE){a=b._doc.body.createControlRange();a.add(d);a.select()}else try{var f=AjaxControlToolkit.HTMLEditor.__getIndex(d);e.collapseToEnd();b._removeAllRanges(e);a=b._createRange(e);a.setStart(d.parentNode,f);a.setEnd(d.parentNode,f+1);b._selectRange(e,a)}catch(g){return true}return false}return true}return false},_ifShadow:function(){if(AjaxControlToolkit.HTMLEditor.isIE)try{var g=this._doc.selection}catch(h){return false}var b=this,d=null,a=AjaxControlToolkit.HTMLEditor.getSelParent(b);while(a&&(a.nodeType==3||a.tagName&&a.tagName.toUpperCase()!="BODY")){if(a.nodeType==3||!a.tagName){a=a.parentNode;continue}var f=a.tagName.toUpperCase();if(f=="TABLE"&&a.getAttribute(AjaxControlToolkit.HTMLEditor.noContextMenuAttribute)&&a.getAttribute(AjaxControlToolkit.HTMLEditor.noContextMenuAttribute)=="yes"){d=a.rows.item(0).cells.item(0).firstChild;if(AjaxControlToolkit.HTMLEditor.isIE&&f=="P")d=d.firstChild;break}a=a.parentNode}if(d!=null){var e=b._getSelection(),c=b._createRange(e);if(AjaxControlToolkit.HTMLEditor.isIE){c=b._doc.body.createControlRange();c.add(d);c.select()}else try{e.collapseToEnd();b._removeAllRanges(e);c=b._createRange(e);c.setStart(d.parentNode,0);c.setEnd(d.parentNode,1);b._selectRange(e,c)}catch(h){}}},_saveContent:function(){var a=this,b,d,c;try{try{b=a._getSelection();d=a._createRange(b)}catch(e){}c=new AjaxControlToolkit.HTMLEditor._Marker(a,d,b)}catch(e){return}if(!a.__stack){a.__stack=[];a.__stackPos=0}while(a.__stackPos<a.__stack.length)a.__stack.pop();if(a.__stack.length==AjaxControlToolkit.HTMLEditor.__stackMaxSize){a.__stack.reverse();a.__stack.pop();a.__stack.reverse()}a.__stack.push(c);a.__stackPos=a.__stack.length},_restoreContent:function(){var a=this;if(a.__stack&&a.__stackPos>=0&&a.__stackPos<a.__stack.length){var b=a.__stack[a.__stackPos],f,d;if(AjaxControlToolkit.HTMLEditor.isIE){function o(d,b,e,a,c){return b.replace(/\salign=[^\s>]*/ig,"")+(a=='"X"'?"":"align="+a)+c.replace(/\salign=[^\s>]*/ig,"")}for(var l=a._doc.body.getElementsByTagName("EMBED"),h=[],c=0;c<l.length;c++)h.push(l[c]);for(var i=0;i<h.length;i++)h[i].parentNode.removeChild(h[i]);var g=b._save.replace(/&amp;/ig,"&");g=g.replace(/(<embed(?:.*?))(teoalign=)(\"[^\"]*\")((?:.*?)>)/ig,o);a._doc.body.innerHTML="!!!<span></span>"+AjaxControlToolkit.HTMLEditor.Trim(g);a._doc.body.firstChild&&a._doc.body.removeChild(a._doc.body.firstChild);a._doc.body.firstChild&&a._doc.body.removeChild(a._doc.body.firstChild);var k=AjaxControlToolkit.HTMLEditor.getHrefsText(g);AjaxControlToolkit.HTMLEditor.setHrefsText(a._doc.body,k);if(a._editPanel.get_relativeImages()){k=AjaxControlToolkit.HTMLEditor.getImagesText(g);AjaxControlToolkit.HTMLEditor.setImagesText(a._doc.body,k)}AjaxControlToolkit.HTMLEditor.setNames(a._doc.body,b._nArr);AjaxControlToolkit.HTMLEditor.operateAnchors(a,a._doc,!a._editPanel.get_showAnchors());AjaxControlToolkit.HTMLEditor.operatePlaceHolders(a,a._doc,!a._editPanel.get_showPlaceHolders());if(b._tree!=null){var e=a._doc.body,c;try{for(c=b._tree.length-1;c>=0;c--)e=e.childNodes.item(b._tree[c])}catch(q){if(a.__stackPos>0){a.__stackPos--;a._restoreContent();a.__stackPos++}return}try{var n=a._doc.body.createControlRange();n.add(e);n.select()}catch(q){}}else{var j=a;setTimeout(function(){try{if(j._editPanel==AjaxControlToolkit.HTMLEditor.LastFocusedEditPanel){f=j._getSelection();d=j._createRange(f);if(f.type.toLowerCase()!="control")try{d.moveToPoint(b._offsetLeft,b._offsetTop)}catch(a){}d.select()}}catch(a){}},0)}}else{if(AjaxControlToolkit.HTMLEditor.isOpera)a._doc.body.innerHTML=AjaxControlToolkit.HTMLEditor.Trim(b._save);else{a._doc.body.innerHTML="";for(var c=0;c<b._save.childNodes.length;c++)a._doc.body.appendChild(b._save.childNodes.item(c).cloneNode(true))}AjaxControlToolkit.HTMLEditor.operateAnchors(a,a._doc,!a._editPanel.get_showAnchors());AjaxControlToolkit.HTMLEditor.operatePlaceHolders(a,a._doc,!a._editPanel.get_showPlaceHolders());try{f=a._getSelection();d=a._createRange();a._removeAllRanges(f)}catch(q){}for(var p="",e=a._doc.body,c=b._tree.length-1;c>=0;c--){p+=" "+b._tree[c];e=e.childNodes.item(b._tree[c])}var m=b._offset;try{d.setStart(e,m);d.setEnd(e,m)}catch(q){AjaxControlToolkit.HTMLEditor.inspectForShadows(a._doc.body);return}try{a._selectRange(f,d)}catch(q){}}try{AjaxControlToolkit.HTMLEditor.inspectForShadows(a._doc.body)}catch(q){}}},SaveContent:function(){this._saveContent()},RestoreContent:function(){this._undo(false)},_undo:function(c){var a=this;if(a.__stack)if(a.__stackPos>0){a.__stackPos==a.__stack.length&&c&&a._saveContent();do{var d=AjaxControlToolkit.HTMLEditor.Trim(a._doc.body.innerHTML);a.__stackPos--;a._restoreContent()}while(AjaxControlToolkit.HTMLEditor.Trim(a._doc.body.innerHTML)==d&&a.__stackPos>0&&c);var b=a;setTimeout(function(){try{b._ifShadow()}catch(a){}if(b._editPanel==AjaxControlToolkit.HTMLEditor.LastFocusedEditPanel)try{b._editPanel.updateToolbar()}catch(a){}!c&&b.onContentChanged()},0)}},_redo:function(){var a=this;if(a.__stack)if(a.__stackPos<a.__stack.length-1){a.__stackPos++;var b=a,c;if(AjaxControlToolkit.HTMLEditor.isIE){c=b._doc.body.getElementsByTagName("EMBED").length;if(c>0){var d=b._body.ownerDocument.createElement("div");b._body.appendChild(d);setTimeout(function(){b._body.removeChild(d)},0)}}a._restoreContent();var b=a;setTimeout(function(){b._ifShadow();b._editPanel.updateToolbar()},0)}},undo:function(){this._undo(true);this.onContentChanged()},redo:function(){this._redo();this.onContentChanged()},_contextMenuCallP:function(){},onContentChanged:function(){},_copyCut:function(i,q){var e=true,a=this,l=a;if(AjaxControlToolkit.HTMLEditor.isIE){var c=a._getSelection(),b=a._createRange(c),j=false,f="";i=="x"&&a._saveContent();if(c.type.toLowerCase()=="control"){j=e;f=AjaxControlToolkit.HTMLEditor.getHTML(b.item(0),e)}else if(b.text!=""){j=e;f=b.htmlText;var o=b.duplicate(),h=a._getTextNodeCollection();if(h.length<1)return;var m=AjaxControlToolkit.HTMLEditor._commonParent(h[0],h[h.length-1]);if(m!=null&&h[0].previousSibling&&h[0].previousSibling.nodeType==3){var g=m.parent;while(g&&g.tagName.toUpperCase()!="BODY"&&AjaxControlToolkit.HTMLEditor.isStyleTag(g.tagName)){var n=g.cloneNode(false);n.innerHTML=f;f=n.outerHTML;g=g.parentNode}}c=a._getSelection();c.empty();b=a._createRange(c);b.setEndPoint("EndToEnd",o);b.setEndPoint("StartToStart",o);b.select()}else if(b.htmlText!=""){j=e;f=b.htmlText}if(j){var d=a._doc.createElement("DIV");d.innerHTML="!!!<span></span>"+f;d.removeChild(d.firstChild);d.removeChild(d.firstChild);var k=AjaxControlToolkit.HTMLEditor.getHTML(d,false,e),p=new RegExp("(<[/]?)(teo"+AjaxControlToolkit.HTMLEditor.smartClassName+":)","ig");k=k.replace(p,"$1");delete d;a._contentCopy(k,e);b.select();if(i=="x"){c.clear();a._clearP()}}else if(i=="x"){c.clear();a._clearP()}q&&setTimeout(function(){l._editPanel.updateToolbar()},0)}else if(i=="x"){a._saveContent();var c=a._getSelection(),b=a._createRange(c);a._removeAllRanges(c);b.deleteContents();if(a._doc.body.innerHTML==""){a._doc.body.innerHTML="<br/>";b.setStart(a._doc.body,0);b.setEnd(a._doc.body,0)}l.onContentChanged();a._selectRange(c,b)}else{var c=a._getSelection(),b=a._createRange(c);a._removeAllRanges(c);alert(String.format(AjaxControlToolkit.Resources.HTMLEditor_toolbar_button_Use_verb,AjaxControlToolkit.HTMLEditor.isSafari&&navigator.userAgent.indexOf("mac")!=-1?"Apple-C":"Ctrl-C"));a._selectRange(c,b)}},_paste:function(m,n){var c=this,d=c,o=c._getSelection(),g=c._createRange(o),k,l;if(!m){k=g.offsetLeft;l=g.offsetTop;c.insertHTML(c._getPlain());d.onContentChanged();return}if(c._editPanel.get_noPaste())return;k=g.offsetLeft;l=g.offsetTop;var b=c._doc.createElement("span"),a,h=c._contentCopy("",false,n);if(/<[\/]*p[\s>]+/i.test(h)||/<[\/]*h/i.test(h))a=c._getSafePlace();else{a=c._doc.createElement("SPAN");a.id=AjaxControlToolkit.HTMLEditor.smartClassName;if(!c.insertHTML(AjaxControlToolkit.HTMLEditor.getHTML(a,true)))return;a=c._doc.getElementById(AjaxControlToolkit.HTMLEditor.smartClassName);if(a){a.id=null;a.removeAttribute("id");a.setAttribute("para","no")}}b.innerHTML=h;if(!a)return;c._checkImages(b);var i=a.parentNode,f=a.getAttribute("para");if(f!="no"){if(f.indexOf("left")>=0&&b.firstChild)if(b.firstChild.tagName&&b.firstChild.tagName.toUpperCase()=="P"){while(b.firstChild.firstChild)a.previousSibling.appendChild(b.firstChild.firstChild);b.removeChild(b.firstChild)}if(f.indexOf("right")>=0&&b.lastChild)if(b.lastChild.tagName&&b.lastChild.tagName.toUpperCase()=="P"){while(b.lastChild.lastChild)a.nextSibling.insertBefore(b.lastChild.lastChild,a.nextSibling.firstChild);b.removeChild(b.lastChild)}}var j=a,e=null;if(b.childNodes.length==0&&f.indexOf("left")>=0&&f.indexOf("right")>=0){if(a.nextSibling.firstChild){e=c._doc.createElement("span");j=e;e.innerHTML="111";a.previousSibling.appendChild(e)}while(a.nextSibling.firstChild)a.previousSibling.appendChild(a.nextSibling.firstChild);i.removeChild(a.nextSibling)}else while(b.firstChild)i.insertBefore(b.firstChild,a);setTimeout(function(){var c=d._getSelection(),b=d._createRange(c);if(c.type.toLowerCase()=="control")while(b.length>0)b.remove(0);try{b.collapse(false)}catch(f){}d.focusEditor();AjaxControlToolkit.HTMLEditor._setCursor(j,d);e&&e.parentNode.removeChild(e);i.removeChild(a);AjaxControlToolkit.HTMLEditor.inspectForShadows(d._doc.body);d.onContentChanged();b.select()},0)},_contentCopy:function(i,n,p){var j=true,o="$1<br/>$3",m="$1&nbsp;$3",b=this;if(i!="")i=i.replace(/(<td[^>]*?>)([\s ]*?)(<\/td[^>]*?>)/ig,m).replace(/(<td[^>]*?>)\s*(&nbsp;)\s*(<\/td[^>]*?>)/ig,o).replace(/(<p[^>]*?>)\s*(&nbsp;)\s*(<\/p[^>]*?>)/ig,o);var e=b._doc.createElement("iframe");e.width="0";e.height="0";if(AjaxControlToolkit.HTMLEditor.isIE)e.src="javascript:false;";b._doc.appendChild(e);var a=e.contentWindow.document;a.write("<html><head></head><body>"+i+"</body></html>");a.close();a.body.contentEditable=j;var k=a.body.createTextRange(),q=false;if(i==""){k.execCommand("paste");for(var t=a.createElement("DIV"),d=0;d<a.body.childNodes.length;d++){var h=a.body.childNodes.item(d);if(h.nodeType==8){var c=""+h.data+"";if(c.search(/StartFragment/i)>=0)if(h.nextSibling&&h.nextSibling.nodeType==3){var c=""+h.nextSibling.data+"";if(c.length)if(c.charCodeAt(0)==160){c=c.substr(1);h.nextSibling.data=c;q=j;break}}}}if(typeof p!="undefined"&&p)a.body.innerHTML=AjaxControlToolkit.HTMLEditor.cleanUp(a.body.innerHTML);var c=AjaxControlToolkit.HTMLEditor.Trim(AjaxControlToolkit.HTMLEditor.getHTML(a.body,false,j));c=c.replace(/(<script(?:[^>]*?)>(?:[^<]*?)<\/script(?:[^>]*?)>)/gi,"");a.body.innerHTML=c;if(!n){AjaxControlToolkit.HTMLEditor.operateAnchors(b,a,!b.showAnchors);AjaxControlToolkit.HTMLEditor.operatePlaceHolders(b,a,!b.showPlaceHolders);for(var l=a.body.getElementsByTagName("EMBED"),f=[],d=0;d<l.length;d++)f.push(l[d]);for(var g=0;g<f.length;g++)f[g].parentNode.removeChild(f[g])}delete k;delete t;if(n&&AjaxControlToolkit.HTMLEditor.isIE)k=a.body.createTextRange()}if(n&&AjaxControlToolkit.HTMLEditor.isIE){if(i!=""){AjaxControlToolkit.HTMLEditor.operateAnchors(b,a,j);AjaxControlToolkit.HTMLEditor.operatePlaceHolders(b,a,j)}k.select();k.execCommand("copy")}for(var s=AjaxControlToolkit.HTMLEditor.Trim(a.body.innerHTML).replace(/<br\s*[\/]*>\s*<\/td>/ig,"</td>").replace(/(<td[^>]*?>)([\s ]*?)(<\/td[^>]*?>)/ig,m).replace(/(<p[^>]*?>)\s*(<br[^>]*?>)\s*(<\/p[^>]*?>)/ig,m).replace(/(<embed(?:.*?))(wmode=)(\"[^\"]*\")((?:.*?)>)/ig,"$1pseudomode=$3$4").replace(/(<embed)([^>]*?>)/ig,'$1 wmode="transparent"$2'),l=a.body.getElementsByTagName("EMBED"),f=[],d=0;d<l.length;d++)f.push(l[d]);for(var g=0;g<f.length;g++)f[g].parentNode.removeChild(f[g]);e.src="";var r=b;r._doc.removeChild(e);delete e;return s},insertHTML:function(p,c){var n="<span>qqq</span>",b=this;b.focusEditor();var w=b._getSelection();if(typeof c=="undefined")c=b._createRange(w);if(AjaxControlToolkit.HTMLEditor.isIE){function r(b,a){return '<span class="'+AjaxControlToolkit.HTMLEditor.smartClassName+"_script\" style='display:none;visibility:hidden;'>"+a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"}function q(b,a){return a.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}var d='<span id="'+AjaxControlToolkit.HTMLEditor.smartClassName+'">111<span></span>'+p+"</span>",u=AjaxControlToolkit.HTMLEditor.getHrefsText(d),s=AjaxControlToolkit.HTMLEditor.getImagesText(d);if(!b._editPanel.get_noScript())d=d.replace(/(<script(?:[^>]*?)>.*?<\/script(?:[^>]*?)>)/gi,r);else d=d.replace(/(<script(?:[^>]*?)>.*?<\/script(?:[^>]*?)>)/gi,"");var x=b;try{if(c.pasteHTML)c.pasteHTML(d);else{var f=b._doc.createElement("DIV");f.innerHTML=d;while(f.firstChild)c(0).parentNode.insertBefore(f.firstChild,c(0));c(0).parentNode.removeChild(c(0));c.remove(0);delete f}}catch(y){return false}var a=b._doc.getElementById(AjaxControlToolkit.HTMLEditor.smartClassName);a.innerHTML=n+AjaxControlToolkit.HTMLEditor.getHTML(a,false,true).replace(new RegExp("<span(?:[^>]*?)class="+AjaxControlToolkit.HTMLEditor.smartClassName+"_script(?:[^>]*?)>(.*?)</span(?:[^>]*?)>","gi"),q)+n;a.removeChild(a.firstChild);a.removeChild(a.lastChild);AjaxControlToolkit.HTMLEditor.setHrefsText(a,u);AjaxControlToolkit.HTMLEditor.setImagesText(a,s);a.firstChild&&a.removeChild(a.firstChild);a.firstChild&&a.removeChild(a.firstChild);while(a.firstChild)a.parentNode.insertBefore(a.firstChild,a);a.parentNode.removeChild(a);delete a;return true}else{var f=b._doc.createElement("div");f.innerHTML=p;for(var m=f.getElementsByTagName("EMBED"),j=[],h=0;h<m.length;h++)j.push(m[h]);for(var l=0;l<j.length;l++){var i=j[l],g=document.createElement("IMG"),o=i.attributes;g.src=b._images_list[1];g.setAttribute("dummytag","embed");for(var h=0;h<o.length;++h){var k=o.item(h);if(!k.specified)continue;var e=k.name.toLowerCase(),t=k.value;if(e=="src")e="dummysrc";else if(e=="bgcolor")e="dummybgcolor";else if(e=="wmode")e="pseudomode";g.setAttribute(e,t)}g.getAttribute("type");g.style.cssText="border: 1px dotted #000000; background-image: url('"+(g.getAttribute("type").toLowerCase()=="application/x-mplayer2"?b._images_list[3]:b._images_list[2])+"'); background-position: center; background-repeat: no-repeat; background-color: #c0c0c0;";i.parentNode.insertBefore(g,i);i.parentNode.removeChild(i)}var v=b.insertNodeAtSelection(f,c);return v}},insertNodeAtSelection:function(e,b){var d=false,c=this;if(!AjaxControlToolkit.HTMLEditor.isIE){var f=c._getSelection();if(typeof b=="undefined")try{b=c._createRange(f)}catch(l){c._removeAllRanges(f);return d}var a=b.startContainer,j=b.startOffset;if(a.ownerDocument.id!="EditorDocument")return d;if(b.startContainer.nodeType==1&&b.startContainer.tagName.toUpperCase()=="TR"||b.endContainer.nodeType==1&&b.endContainer.tagName.toUpperCase()=="TR")return d;c._removeAllRanges(f);b.deleteContents();try{b=c._createRange()}catch(l){c._removeAllRanges(f);return d}switch(a.nodeType){case 3:if(j>0)a=a.splitText(j);while(e.firstChild)a.parentNode.insertBefore(e.firstChild,a);b.setStart(a,0);b.setEnd(a,0);break;case 1:case 11:try{c._removeAllRanges(f);if(a.childNodes.length>=j+1){a=a.childNodes.item(j);while(e.firstChild)a.parentNode.insertBefore(e.firstChild,a);var g=c._doc.createTextNode("");a.parentNode.insertBefore(g,a);a=g}else{var g=c._doc.createTextNode("");if(AjaxControlToolkit.HTMLEditor.canHaveChildren(a)){while(e.firstChild)a.appendChild(e.firstChild);a.appendChild(g)}else{while(e.firstChild)a.parentNode.insertBefore(e.firstChild,a);a.parentNode.insertBefore(g,a)}a=g}if(a.nodeType==1){for(var h=a.parentNode,k=h,i=0;i<h.childNodes.length;i++)if(a==h.childNodes.item(i))break;b.setStart(h,i);b.setEnd(h,i)}else{b.setStart(a,0);b.setEnd(a,0)}}catch(l){c._removeAllRanges(f);return d}}c._selectRange(f,b);return true}else return d},trickWithStyles:function(j){var a=this,c=a._doc.getElementById(j);if(c!=null)if(c.nextSibling&&c.nextSibling.nodeType==3){var b=c.nextSibling;c.parentNode.removeChild(c);var e=(""+b.data+"").indexOf(" ");if(e>0)b.splitText(e);else e==0&&b.splitText(1);if(a.n_arr!=null)for(var h=0;h<a.n_arr.length;h++)a.MSIE_applyCssStyle(a.n_arr[h],[b],false);a.n_arr=null;var g=a._getSelection();if(!AjaxControlToolkit.HTMLEditor.isIE){var f=a._doc.createRange();f.setStart(b,b.length);f.setEnd(b,b.length);a._removeAllRanges(g);a._selectRange(g,f)}else{var i=a._createRange(g),d=a._doc.createElement("span");if(b.nextSibling)b.parentNode.insertBefore(d,b.nextSibling);else b.parentNode.appendChild(d);try{i.moveToElementText(d);i.select()}catch(k){}d.parentNode.removeChild(d)}}else c.parentNode.removeChild(c)},_getParent:function(a){if(AjaxControlToolkit.HTMLEditor.isIE)return a.parentElement();else return a.startContainer},_checkImages:function(g){var e="qwerty.gif";if(this._editPanel.get_relativeImages())for(var f=g.getElementsByTagName("IMG"),d=0;d<f.length;d++){var a=f[d];if(a.src.indexOf("http://")>=0){var b=a.src;a.src=e;var c=a.src.indexOf(e);if(b.substr(0,c)==a.src.substr(0,c))b=b.substr(c,b.length-c);a.src=b}}},_getSafePlace:function(d){var e="para",b=null,g=this,a=g._doc.createElement("SPAN"),j=g;a.id=AjaxControlToolkit.HTMLEditor.smartClassName;if(typeof d=="undefined"){if(!g.insertHTML(AjaxControlToolkit.HTMLEditor.getHTML(a,true)))return b}else{if(d.nextSibling==b)d.parentNode.appendChild(a);else d.parentNode.insertBefore(a,d.nextSibling);d.parentNode.removeChild(d)}a=g._doc.getElementById(AjaxControlToolkit.HTMLEditor.smartClassName);a.id=b;a.removeAttribute("id");a.setAttribute(e,"no");var c=a.parentNode,f=c.tagName.toUpperCase();while(f!="BODY"&&f!="TD"&&f!="P"&&f!="DIV")if(AjaxControlToolkit.HTMLEditor.isStyleTag(c.tagName)){c=c.parentNode;f=c.tagName.toUpperCase()}else break;if(f=="P"){a.setAttribute(e,"");function i(k,a,e,f){var l,d=AjaxControlToolkit.HTMLEditor.myClone(e,j._doc,false);k&&d.appendChild(k);while(a){if(a.nodeType==1||a.nodeType==3&&AjaxControlToolkit.HTMLEditor.Trim(""+a.data+"").length>0){var g=b;if(a.tagName&&a.tagName.toUpperCase()=="SCRIPT")g=a.text;var h=AjaxControlToolkit.HTMLEditor.myClone(a,j._doc,true);if(d.childNodes.length==0||!f)d.appendChild(h);else d.insertBefore(h,d.firstChild);if(g!=b)h.text=g}a=f?a.previousSibling:a.nextSibling}if(d.childNodes.length==0){delete d;d=b}if(e==c)return d;else return i(d,f?e.previousSibling:e.nextSibling,e.parentNode,f)}var k=i(b,a.previousSibling,a.parentNode,true),l=i(b,a.nextSibling,a.parentNode,false),h=c.parentNode;if(k){h.insertBefore(k,c);a.setAttribute(e,a.getAttribute(e)+" left")}h.insertBefore(a,c);if(l){h.insertBefore(l,c);a.setAttribute(e,a.getAttribute(e)+" right")}h.removeChild(c)}return a},noContextMenuAttributeName:function(){return AjaxControlToolkit.HTMLEditor.noContextMenuAttribute},_getTextNodeCollection:function(x){var a="",u="<span id='",n="undefined",f=null,d=this,e=[];if(d.isControl())return e;var o=d._getSelection(),j=d._createRange(o),m=AjaxControlToolkit.HTMLEditor.smartClassName+"_right",r=AjaxControlToolkit.HTMLEditor.smartClassName+"_left",g=f,i=f,q;if(typeof x==n){if(AjaxControlToolkit.HTMLEditor.isIE){g=j.duplicate();i=j.duplicate();g.setEndPoint("EndToStart",j);i.setEndPoint("StartToEnd",j)}else{g=j.cloneRange();i=j.cloneRange();g.setEnd(g.startContainer,g.startOffset);i.setStart(i.endContainer,i.endOffset);q=g.endOffset}if(!d.insertHTML(u+m+"'/>",i))return e;else{if(AjaxControlToolkit.HTMLEditor.isOpera){g.setEnd(g.startContainer,q);g.setStart(g.startContainer,q)}if(!d.insertHTML(u+r+"'/>",g)){var t=d._doc.getElementById(m);if(t!=f){h=t.parentNode;h.removeChild(t)}var s=d._doc.getElementById(rl);if(s!=f){h=s.parentNode;h.removeChild(s)}return e}}}else{var k;k=d._doc.createElement("SPAN");k.id=m;d._doc.body.appendChild(k);k=d._doc.createElement("SPAN");k.id=r;d._doc.body.insertBefore(k,d._doc.body.firstChild)}var b=d._doc.getElementById(r),c=d._doc.getElementById(m);if(b==f||c==f){var h;if(b!=f){h=b.parentNode;h.removeChild(b)}if(c!=f){h=c.parentNode;h.removeChild(c)}return []}while(b.firstChild)b.removeChild(b.firstChild);while(c.firstChild)c.removeChild(c.firstChild);while(b.previousSibling&&b.previousSibling.nodeType==3&&AjaxControlToolkit.HTMLEditor.Trim(a+b.previousSibling.data+a).length==0)b.parentNode.removeChild(b.previousSibling);while(b.nextSibling&&b.nextSibling.nodeType==3&&AjaxControlToolkit.HTMLEditor.Trim(a+b.nextSibling.data+a).length==0)b.parentNode.removeChild(b.nextSibling);while(c.previousSibling&&c.previousSibling.nodeType==3&&AjaxControlToolkit.HTMLEditor.Trim(a+c.previousSibling.data+a).length==0)c.parentNode.removeChild(c.previousSibling);while(c.nextSibling&&c.nextSibling.nodeType==3&&AjaxControlToolkit.HTMLEditor.Trim(a+c.nextSibling.data+a).length==0)c.parentNode.removeChild(c.nextSibling);var w=false,l=d;function v(b,d){while(b){if(b.id&&b.id==m){w=true;return}if(b.nodeType==3){while(b.nextSibling&&(b.nextSibling.nodeType==3||!AjaxControlToolkit.HTMLEditor.isIE&&typeof l.__saveBM__!=n&&l.__saveBM__!=f&&l.__saveBM__[0]==b.nextSibling)){if(b.nextSibling.nodeType==3)b.data=a+b.data+a+b.nextSibling.data+a;else{l.__saveBM__[0]=b;l.__saveBM__[1]=(a+b.data+a).length}b.parentNode.removeChild(b.nextSibling)}AjaxControlToolkit.HTMLEditor.Trim(a+b.data+a).length>0&&e.push(b)}else{var c=b.tagName;if(b.tagName){c=c.toUpperCase();if(!(c=="MAP"||c=="AREA"||c=="SCRIPT"||c=="NOSCRIPT"))!(b.style&&(AjaxControlToolkit.HTMLEditor.getStyle(b,"display")=="none"||AjaxControlToolkit.HTMLEditor.getStyle(b,"visibility")=="hidden"))&&v(b.firstChild,false)}}if(w)return;var g=b.parentNode;if(d)while(b.nextSibling==f)b=b.parentNode;b=b.nextSibling}}v(b,true);var h;h=b.parentNode;h.removeChild(b);h=c.parentNode;h.removeChild(c);if(typeof x==n)if(AjaxControlToolkit.HTMLEditor.isIE){o.empty();i.select()}else if(e.length>0){d._removeAllRanges(o);var p=d._createRange();p.setEnd(e[e.length-1],e[e.length-1].length);p.setStart(e[e.length-1],e[e.length-1].length);d._selectRange(o,p)}return e},_getPlain:function(){var a=this._doc.createElement("textarea");a.width="0";a.height="0";this._doc.appendChild(a);var c=a.createTextRange();c.execCommand("paste");var b=a.value;b=b.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"").replace(/\n/g,"<br/>");this._doc.removeChild(a);return b},_execCommand:function(c,g,b){var e=false,h="createlink",a=this,i=a,d,f;if(AjaxControlToolkit.HTMLEditor.isIE&&!a.isControl()){d=a._getSelection();f=a._createRange(d);var j=f.parentElement();if(j.tagName.toUpperCase()=="TEXTAREA")return}c.toLowerCase()!=h&&a._saveContent();switch(c.toLowerCase()){case h:if(AjaxControlToolkit.HTMLEditor.isIE||!g)a._doc.execCommand(c,g,b);else{var b;(b=prompt("Enter URL"))&&a._doc.execCommand(c,e,b)}break;case "backcolor":case "forecolor":case "fontname":case "fontsize":a.MSIE_applyCommand(c.toLowerCase(),b);break;case "indent":a.MSIE_indent(true);break;case "outdent":a.MSIE_indent(e);break;case "justifyleft":a.MSIE_justify("left");break;case "justifyfull":a.MSIE_justify("justify");break;case "justifycenter":a.MSIE_justify("center");break;case "justifyright":a.MSIE_justify("right");break;case "paragraph":a.MSIE_justify("remain",e,"P");break;case "formatblock":if(b!=null&&typeof b=="string"&&b.length==2)if(b.substr(0,1).toUpperCase()=="H"&&parseInt(b.substr(1,1))>0){a.MSIE_justify("remain",e,b);break}a._doc.execCommand(c,g,b);break;case "insertunorderedlist":a.MSIE_list("UL");break;case "insertorderedlist":a.MSIE_list("OL");break;case "bold":case "italic":case "underline":case "strikethrough":case "superscript":case "subscript":a.MSIE_applyCommand(c.toLowerCase());break;default:a._doc.execCommand(c,g,b)}a.onContentChanged();if(!AjaxControlToolkit.HTMLEditor.isIE){d=a._getSelection();f=a._createRange(d);a._removeAllRanges(d);a._selectRange(d,f);a.focusEditor()}var i=a;setTimeout(function(){i._editPanel.updateToolbar()},0)},MSIE_indent:function(a){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.MSIE_indent)(a)},MSIE_justify:function(c,b,a){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.MSIE_justify)(c,b,a)},MSIE_list:function(a){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.MSIE_list)(a)},getSelectionAfterOperation:function(a){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.getSelectionAfterOperation)(a)},setSelectionAfterOperation:function(b,a){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.setSelectionAfterOperation)(b,a)},get_paragraphs:function(){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.get_paragraphs)()},getPseudoP:function(){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.getPseudoP)()},getPseudoP_Recur:function(b,c,a){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.getPseudoP_Recur)(b,c,a)},unWrap:function(a,b){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.unWrap)(a,b)},tryUnWrap:function(a,c,b){return Function.createDelegate(this,AjaxControlToolkit.HTMLEditor.tryUnWrap)(a,c,b)},MSIE_applyCommand:function(n,g){var f=null,k="vertical-align",j="text-decoration",i="underline",d=false,a=this,l=!AjaxControlToolkit.HTMLEditor.isIE?AjaxControlToolkit.HTMLEditor.Trim(a.getSelectedHTML()):"";if(a.isControl())return;var e=a._getSelection(),c=a._createRange(e),o=AjaxControlToolkit.HTMLEditor.isIE?[c.boundingLeft,c.boundingTop]:[c.startContainer,c.startOffset],m=AjaxControlToolkit.HTMLEditor.isIE&&c.text.length>0||!AjaxControlToolkit.HTMLEditor.isIE&&l.length>0,b={name:"none",value:"none"};switch(n.toLowerCase()){case "bold":b={name:"font-weight",value:"bold",repl:d};break;case "italic":b={name:"font-style",value:"italic",repl:d};break;case i:b={name:j,value:i,repl:d};break;case "strikethrough":b={name:j,value:"line-through",repl:d};break;case "superscript":b={name:k,value:"super",repl:d};break;case "subscript":b={name:k,value:"sub",repl:d};break;case "forecolor":b={name:"color",value:g,repl:d};break;case "backcolor":b={name:"background-color",value:g,repl:d};break;case "fontname":b={name:"font-family",value:g,repl:d};break;case "fontsize":b={name:"font-size",value:g,repl:d}}if(m){var h=a._getTextNodeCollection();a.MSIE_applyCssStyle(b,h,true)}else{if(a.isControl())return;var h=a._tryExpand();if(h.length>0){a.MSIE_applyCssStyle(b,h,d);if(AjaxControlToolkit.HTMLEditor.isIE&&a.__saveBM__!=f){e=a._getSelection();c=a._createRange(e);c.moveToBookmark(a.__saveBM__);c.select();a.__saveBM__=f}else if(a.__saveBM__!=f){if(a.__saveBM__[0].nodeType==3){e=a._getSelection();c=a._doc.createRange();c.setStart(a.__saveBM__[0],a.__saveBM__[1]);c.setEnd(a.__saveBM__[0],a.__saveBM__[1]);a._removeAllRanges(e);a._selectRange(e,c)}else{a._trySelect(a.__saveBM__[0],a.__saveBM__[0]);a.__saveBM__[0].parentNode.removeChild(a.__saveBM__[0])}a.__saveBM__=f}}else a._setStyleForTyping(b)}},MSIE_applyCssStyle:function(h,c,J){var q=true,G="text-decoration",u=null,p="SPAN",i=this,b=h.name.replace(/\-(\w)/g,function(b,a){return a.toUpperCase()}),d=h.value,L=h.repl,A=false,B=false;i._saveContent();var N=AjaxControlToolkit.HTMLEditor.smartClassName+"_right",M=AjaxControlToolkit.HTMLEditor.smartClassName+"_left",o=i._doc.createElement(p);o.id=M;var m=i._doc.createElement(p);m.id=N;c[0].parentNode.insertBefore(o,c[0]);if(c[c.length-1].nextSibling!=u)c[c.length-1].parentNode.insertBefore(m,c[c.length-1].nextSibling);else c[c.length-1].parentNode.appendChild(m);AjaxControlToolkit.HTMLEditor.unStyle(o);AjaxControlToolkit.HTMLEditor.unStyle(m);for(var n=[],g=0;g<c.length;g++){for(var l=c[g],a=l.parentNode,z=0;z<n.length;z++){var x=n[z];if(x.parent==a){x.textNodes.push(l);break}}z==n.length&&n.push({parent:a,textNodes:[l]})}for(var g=0;g<n.length;g++){var x=n[g];if(x.textNodes.length>1){var e=x.textNodes,w=i._doc.createElement(p),t=i._doc.createElement(p);e[0].parentNode.insertBefore(w,e[0]);if(e[e.length-1].nextSibling!=u)e[e.length-1].parentNode.insertBefore(t,e[e.length-1].nextSibling);else e[e.length-1].parentNode.appendChild(t);AjaxControlToolkit.HTMLEditor._moveTagsUp(w,t);w.parentNode.removeChild(w);t.parentNode.removeChild(t)}}for(var g=0;g<c.length;g++){var l=c[g],a=l.parentNode,D=false;while(a&&a.tagName&&a.childNodes.length==1&&AjaxControlToolkit.HTMLEditor.isStyleTag(a.tagName)){var f=a.tagName.toUpperCase();if((f=="I"||f=="EM")&&h.name=="font-style"||(f=="B"||f=="STRONG")&&h.name=="font-weight"||(f=="S"||f=="STRIKE")&&h.name==G||f=="U"&&h.name==G||(f=="SUB"||f=="SUP")&&h.name=="vertical-align"){var v=a;a=a.parentNode;while(v.firstChild)a.insertBefore(v.firstChild,v);a.removeChild(v);D=q;continue}else if(a.style&&a.style[b]&&a.style[b].length>0){var k=a.style[b];if(b.toLowerCase().indexOf("color")>=0||b=="fontFamily"||b=="fontSize")a.style[b]=d;else if(L)try{a.style[b]=a.style[b]+" "+d;if(k==a.style[b])a.style[b]=d}catch(O){a.style[b]=d}else if(!A){var F=k.replace(d,"");if(b=="fontWeight"&&k.toString()=="700")F="";if(F==k)try{a.style[b]=a.style[b]+" "+d;if(k==a.style[b])a.style[b]=d}catch(O){a.style[b]=d}else{a.style[b]=F.replace(/,/,"");B=q}A=q}else if(B)a.style[b]=k.replace(d,"").replace(/,/,"");else try{a.style[b]=a.style[b]+" "+d;if(k==a.style[b])a.style[b]=d}catch(O){a.style[b]=d}D=q}a=a.parentNode}if(!D&&!B){var y;y=i._doc.createElement(p);y.style[b]=d;var K=l.parentNode;K.insertBefore(y,l);y.appendChild(l);A=q}}var j=AjaxControlToolkit.HTMLEditor._commonTotalParent(o,m),I=j.parent.childNodes.item(j.indexFirst).previousSibling,s=j.parent.childNodes.item(j.indexLast).nextSibling;o.parentNode.removeChild(o);m.parentNode.removeChild(m);var H=0,r=j.parent.childNodes.length;if(I!=u)H=AjaxControlToolkit.HTMLEditor.__getIndex(I);if(s!=u){r=AjaxControlToolkit.HTMLEditor.__getIndex(s)+1;if(r<j.parent.childNodes.length)if(s.nodeType==3)r++;else if(s.nodeType==1){var E=s.tagName.toUpperCase();if(E!="TR"&&E!="TD"&&E!="LI")r++}}AjaxControlToolkit.HTMLEditor.spanJoiner(j.parent,i._doc,H,r);var C=i;J&&C._selectRng(c);setTimeout(function(){!AjaxControlToolkit.HTMLEditor.isIE&&C.focusEditor();C._editPanel.updateToolbar()},0)},_tryExpand:function(p){var u="'></span><span id='",h=false,n="undefined",a=this,v=[],i,j,m=a._getSelection(),b=a._createRange(m),l,k,x=AjaxControlToolkit.HTMLEditor.smartClassName+"_right_add",w=AjaxControlToolkit.HTMLEditor.smartClassName+"_left_add",q=AjaxControlToolkit.HTMLEditor.smartClassName+"_middle_add";if(AjaxControlToolkit.HTMLEditor.isIE&&typeof p==n){b.execCommand("bold");a.__saveBM__=b.getBookmark();b.execCommand("bold")}if(AjaxControlToolkit.HTMLEditor.isIE){var d=null,r="<span id="+q+"></span>",o=b.duplicate();try{b.pasteHTML(r)}catch(y){}d=a._doc.getElementById(q);if(d==null)return [];if(typeof p!=n)a.__saveBM__=d;if(d.nextSibling!=null&&!AjaxControlToolkit.HTMLEditor.isInlineElement(d.nextSibling)){d.parentNode.removeChild(d);return []}b.expand("word");b.select();if(b.text.length==0){d.parentNode.removeChild(d);o.select();return []}var t=new RegExp(r,"ig");if(!t.test(b.htmlText.replace(/[\n\r]/g,""))){d.parentNode.removeChild(d);o.select();return []}t=new RegExp(r+"(</span>|&nbsp;|[\\s])*$","ig");if(t.test(b.htmlText.replace(/[\n\r]/g,""))){d.parentNode.removeChild(d);o.select();return []}while(b.text.length>0&&b.text.substr(b.text.length-1,1)==" "){b.moveEnd("character",-1);b.select();if(b.text.length==0){d.parentNode.removeChild(d);o.select();return []}}typeof p==n&&d.parentNode.removeChild(d);return a._getTextNodeCollection()}function s(b){var a=/[\d\w]/;if(a.test(b))return h;a=/[\u0080-\u024F]/;if(a.test(b))return h;a=/[\u0370-\u2000]/;if(a.test(b))return h;return true}if(!a.insertHTML("<span id='"+w+u+q+u+x+"'></span>"))return [];var c=a._doc.getElementById(w),e=a._doc.getElementById(x),g=a._doc.getElementById(q);AjaxControlToolkit.HTMLEditor.positionInParagraph(c,c.previousSibling,true,c.parentNode,s);try{a._trySelect(c,e)}catch(y){}l=a._getSelection();k=a._createRange(l);i=!AjaxControlToolkit.HTMLEditor.isIE?AjaxControlToolkit.HTMLEditor.Trim(a.getSelectedHTML()):"";j=AjaxControlToolkit.HTMLEditor.isIE&&k.text.length>0||!AjaxControlToolkit.HTMLEditor.isIE&&i.length>0;if(!j||a._getTextNodeCollection().length==0){var f=a._doc.createTextNode("");c.parentNode.insertBefore(f,c);c.parentNode.removeChild(c);e.parentNode.removeChild(e);g.parentNode.removeChild(g);var b=a._doc.createRange();b.setStart(f,0);b.setEnd(f,0);b.setStart(f,0);b.setEnd(f,0);a._removeAllRanges(m);a._selectRange(m,b);return []}e.parentNode.insertBefore(c,g);AjaxControlToolkit.HTMLEditor.positionInParagraph(e,e.nextSibling,h,e.parentNode,s);a._trySelect(c,e);l=a._getSelection();k=a._createRange(l);i=!AjaxControlToolkit.HTMLEditor.isIE?AjaxControlToolkit.HTMLEditor.Trim(a.getSelectedHTML()):"";j=AjaxControlToolkit.HTMLEditor.isIE&&k.text.length>0||!AjaxControlToolkit.HTMLEditor.isIE&&i.length>0;if(!j||a._getTextNodeCollection().length==0){var f=a._doc.createTextNode("");c.parentNode.insertBefore(f,c);c.parentNode.removeChild(c);e.parentNode.removeChild(e);g.parentNode.removeChild(g);var b=a._doc.createRange();b.setStart(f,0);b.setEnd(f,0);b.setStart(f,0);b.setEnd(f,0);a._removeAllRanges(m);a._selectRange(m,b);return []}AjaxControlToolkit.HTMLEditor.positionInParagraph(c,c.previousSibling,true,c.parentNode,s);a._trySelect(c,e);l=a._getSelection();k=a._createRange(l);i=!AjaxControlToolkit.HTMLEditor.isIE?AjaxControlToolkit.HTMLEditor.Trim(a.getSelectedHTML()):"";j=AjaxControlToolkit.HTMLEditor.isIE&&k.text.length>0||!AjaxControlToolkit.HTMLEditor.isIE&&i.length>0;if(AjaxControlToolkit.HTMLEditor.isIE)if(typeof p!=n)a.__saveBM__=g;else g.parentNode.removeChild(g);else a.__saveBM__=[g,0];if(j)v=a._getTextNodeCollection();c.parentNode.removeChild(c);e.parentNode.removeChild(e);return v},_setStyleForTyping:function(c){var a=this,i=c.name.replace(/\-(\w)/g,function(b,a){return a.toUpperCase()}),h=c.value,j=c.repl;if(a._StyleForTyping==null)a._StyleForTyping=[];for(var e=[],d=true,b=0;b<a._StyleForTyping.length;b++){var g=a._StyleForTyping[b].name.replace(/\-(\w)/g,function(b,a){return a.toUpperCase()}),f=a._StyleForTyping[b].value;if(!(g==i&&(f==h||j)))e.push(a._StyleForTyping[b]);else d=false}a._StyleForTyping=e;d&&a._StyleForTyping.push(c)},_trySelect:function(c,d){var b=null,a=this,e=a._getSelection(),i=b,j=b;if(AjaxControlToolkit.HTMLEditor.isIE){e.empty();e=a._getSelection();var f=a._createRange(e),g=a._createRange(e);try{c!=b&&f.moveToElementText(c);d!=b&&g.moveToElementText(d);if(c!=b&&d!=b){f.setEndPoint("EndToEnd",g);f.select()}else if(c!=b)f.select();else d!=b&&g.select()}catch(k){}}else try{i=a._doc.createTextNode("");j=a._doc.createTextNode("");c.parentNode.insertBefore(i,c);d.parentNode.insertBefore(j,d);var h=a._doc.createRange();h.setStart(i,0);h.setEnd(j,0);a._removeAllRanges(e);a._selectRange(e,h)}catch(k){}},getSelectedHTML:function(){var c=this._getSelection(),b=this._createRange(c),a=null;if(AjaxControlToolkit.HTMLEditor.isIE)a=b.htmlText;else if(AjaxControlToolkit.HTMLEditor.isSafari&&(c.type=="Caret"||c.type=="None"))a="";else{if(AjaxControlToolkit.HTMLEditor.isSafari)if(b.cloneContents()==null)return "";a=AjaxControlToolkit.HTMLEditor.getHTML(b.cloneContents(),false)}return a},_queryCommandState:function(h){var r="vertical-align",k="line-through",j="strikethrough",q="text-decoration",f="underline",m="font-weight",i="bold",g=this,n=g._rangeStartEnd();if(n==null)return false;try{var a={name:"none",value:"none"};switch(h.toLowerCase()){case i:a={name:m,value:i};break;case "italic":a={name:"font-style",value:"italic"};break;case f:a={name:q,value:f};break;case j:a={name:q,value:k};break;case "superscript":a={name:r,value:"super"};break;case "subscript":a={name:r,value:"sub"}}var b=n.start,c=n.end,d=AjaxControlToolkit.HTMLEditor.getStyle(b,a.name).toString().toLowerCase(),e=AjaxControlToolkit.HTMLEditor.getStyle(c,a.name).toString().toLowerCase();if(a.name==m&&d=="700")d=i;if(a.name==m&&e=="700")e=i;if(/MSIE (5|6)/.test(navigator.userAgent)&&h.toLowerCase()==j&&(d==f||e==f)){while(b&&AjaxControlToolkit.HTMLEditor.isStyleTag(b.tagName)){if(b.style.textDecoration.indexOf(k)>=0){d=b.style.textDecoration;break}b=b.parentNode}while(c&&AjaxControlToolkit.HTMLEditor.isStyleTag(c.tagName)){if(c.style.textDecoration.indexOf(k)>=0){e=c.style.textDecoration;break}c=c.parentNode}}if(AjaxControlToolkit.HTMLEditor.isSafari&&(h.toLowerCase()==j||h.toLowerCase()==f)){var l=h.toLowerCase();if(l==j)l=k;while(b&&AjaxControlToolkit.HTMLEditor.isStyleTag(b.tagName)){if(b.style.textDecoration.indexOf(l)>=0){d=b.style.textDecoration;break}b=b.parentNode}while(c&&AjaxControlToolkit.HTMLEditor.isStyleTag(c.tagName)){if(c.style.textDecoration.indexOf(l)>=0){e=c.style.textDecoration;break}c=c.parentNode}}var o=d.indexOf(a.value)>=0&&e.indexOf(a.value)>=0;if(g._StyleForTyping!=null&&g._StyleForTyping.length>0)for(var p=0;p<g._StyleForTyping.length;p++){var s=g._StyleForTyping[p];if(s.name==a.name&&s.value==a.value){o=!o;break}}return o}catch(t){return false}},_textAlignState:function(b){var a=this._rangeStartEnd();if(a==null)return false;try{var c=this._textAlignStateSingle(a.start),d=this._textAlignStateSingle(a.end);return c==b&&d==b}catch(e){return false}},_textAlignStateSingle:function(a){while(a&&AjaxControlToolkit.HTMLEditor.isStyleTag(a.tagName))a=a.parentNode;if(a!=null){var b=a.tagName.toUpperCase();if(b=="P"||b=="DIV")return a.style.textAlign.toLowerCase()}return null},_rangeStartEnd:function(){var i="<span id='",b=null,e=this;if(e.isControl())return b;try{var o=e._getSelection(),a=e._createRange(o),c=b,d=b;if(!AjaxControlToolkit.HTMLEditor.isIE){function f(c,d){var e=b;while(e==b){if(c.nodeType==3)if(d&&a.startContainer!=a.endContainer&&a.startOffset==c.length&&c.nextSibling)e=f(c.nextSibling,d);else if(!d&&a.startContainer!=a.endContainer&&a.endOffset==0&&c.previousSibling)e=f(c.previousSibling,d);else e=c;else if((d?c.firstChild:c.lastChild)==b)e=b;else e=f(d?c.firstChild:c.lastChild,d);if(e==b){c=d?c.nextSibling:c.previousSibling;if(c==b)return b}else return e}}var n=e._getParent(a);if(n.nodeType!=3&&a.startContainer==a.endContainer&&a.startOffset==a.endOffset&&a.startContainer.childNodes.item(a.startOffset).tagName&&AjaxControlToolkit.HTMLEditor.isStyleTag(a.startContainer.childNodes.item(a.startOffset).tagName))return {start:a.startContainer.childNodes.item(a.startOffset),end:a.startContainer.childNodes.item(a.startOffset)};c=f(a.startContainer,true);if(c!=b&&c.parentNode!=b)c=c.parentNode;if(c==b)c=a.startContainer;d=f(a.endContainer,false);if(d!=b&&d.parentNode!=b)d=d.parentNode;if(d==b)d=a.endContainer}else if(a.text.length==0)c=d=e._getParent(a);else{var m=AjaxControlToolkit.HTMLEditor.smartClassName+"_right_marker",l=AjaxControlToolkit.HTMLEditor.smartClassName+"_left_marker",k=a.duplicate(),j=a.duplicate();k.setEndPoint("EndToStart",a);j.setEndPoint("StartToEnd",a);j.pasteHTML(i+m+"'/>");k.pasteHTML(i+l+"'/>");var g=e._doc.getElementById(l),h=e._doc.getElementById(m);c=g.parentNode;d=h.parentNode;g.parentNode.removeChild(g);h.parentNode.removeChild(h)}return {start:c,end:d}}catch(p){return b}},rtlState:function(){if(this._doc.body.style.direction&&this._doc.body.style.direction=="rtl")return true;return false},openWait:function(){this._editPanel.openWait()},closeWait:function(){this._editPanel.closeWait()}};AjaxControlToolkit.HTMLEditor.DesignPanel.ScriptRecover=function(){var a=this;a.scriptsArray=[];a.scriptsArray_index=-1;a.regReplScript1=function(b,a){this.scriptsArray.push(a);return ""};a.regReplFromScript=function(b,a){return a.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")};a.regReplFromScript1=function(e,c,f,d){var a=this;a.scriptsArray_index++;var b;if(!AjaxControlToolkit.HTMLEditor.isIE)b=a.scriptsArray[a.scriptsArray_index].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"');else b=a.scriptsArray[a.scriptsArray_index];return c+b+d}};AjaxControlToolkit.HTMLEditor.DesignPanel.registerClass("AjaxControlToolkit.HTMLEditor.DesignPanel",AjaxControlToolkit.HTMLEditor.ModePanel);